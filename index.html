<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Fairy Tails K9 Centre - Staff Board</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        /* ================================================================
           MOBILE-FIRST DESIGN SYSTEM
           Base styles = mobile. Scale UP via min-width queries.
           ================================================================ */

        :root {
            --brand-blue: #00acee;
            --brand-blue-dark: #007ba8;
            --brand-gradient: linear-gradient(135deg, #00acee 0%, #007ba8 100%);
            --success-green: #22c55e;
            --warning-amber: #f59e0b;
            --danger-red: #ef4444;
            --bg-light: #f0f4f8;
            --bg-white: #ffffff;
            --text-dark: #1e293b;
            --text-muted: #64748b;
            --text-light: #94a3b8;
            --border-light: #e2e8f0;
            --border-medium: #cbd5e1;
            --shadow-xs: 0 1px 2px rgba(0,0,0,0.04);
            --shadow-sm: 0 1px 3px rgba(0,0,0,0.06), 0 1px 2px rgba(0,0,0,0.04);
            --shadow-md: 0 4px 6px -1px rgba(0,0,0,0.08), 0 2px 4px -2px rgba(0,0,0,0.05);
            --shadow-lg: 0 10px 15px -3px rgba(0,0,0,0.08), 0 4px 6px -4px rgba(0,0,0,0.04);
            --shadow-card: 0 2px 8px rgba(0,0,0,0.06), 0 0 0 1px rgba(0,0,0,0.03);
            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 16px;
            --radius-xl: 20px;
            --radius-full: 9999px;
            /* Bottom nav height for spacing */
            --bottom-nav-height: 64px;
            /* Safe area insets */
            --safe-top: env(safe-area-inset-top, 0px);
            --safe-bottom: env(safe-area-inset-bottom, 0px);
            --safe-left: env(safe-area-inset-left, 0px);
            --safe-right: env(safe-area-inset-right, 0px);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Nunito', sans-serif;
            background: var(--bg-light);
            color: var(--text-dark);
            min-height: 100vh;
            min-height: 100dvh;
            overflow-x: hidden;
            padding-left: var(--safe-left);
            padding-right: var(--safe-right);
            /* Space for fixed bottom nav */
            padding-bottom: calc(var(--bottom-nav-height) + var(--safe-bottom) + 8px);
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* ===== Global Touch-Friendly Styles ===== */

        /* Remove tap highlight flash on Android/iOS */
        button, select, input, a, label, .photo-checkbox, .delete-btn, .tab-btn, .btn, .grooming-select, .grooming-van-select, .bs-date-input, .bs-crate-select, .boarding-date-input, .bottom-tab {
            -webkit-tap-highlight-color: transparent;
        }

        /* Reduce 300ms tap delay on all interactive elements */
        button, select, input, a, label, .tab-btn, .btn, .bottom-tab {
            touch-action: manipulation;
        }

        /* Touch feedback â€” pressed state for buttons */
        .btn:active, .tab-btn:active, .refresh-btn:active {
            transform: scale(0.95) !important;
            opacity: 0.85;
        }

        .delete-btn:active {
            transform: scale(0.9);
            background: var(--danger-red);
            color: white;
        }

        .photo-checkbox:active {
            transform: scale(0.9);
        }

        /* Smooth momentum scrolling on iOS */
        .staging-dogs {
            -webkit-overflow-scrolling: touch;
        }

        /* ================================================================
           HEADER â€” Compact, glassy mobile header
           ================================================================ */
        .header {
            background: var(--brand-gradient);
            color: white;
            padding: 0.6rem 1rem;
            padding-top: calc(0.6rem + var(--safe-top));
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: sticky;
            top: 0;
            z-index: 100;
            /* Subtle bottom glow */
            box-shadow: 0 2px 12px rgba(0, 172, 238, 0.25);
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 0.65rem;
        }

        .logo {
            width: 38px;
            height: 38px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid rgba(255,255,255,0.5);
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
        }

        .header-title {
            font-size: 1.15rem;
            font-weight: 900;
            letter-spacing: -0.02em;
            line-height: 1.1;
        }

        .header-subtitle {
            font-size: 0.7rem;
            opacity: 0.8;
            font-weight: 600;
            letter-spacing: 0.02em;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 0.65rem;
        }

        .current-time {
            font-size: 1.1rem;
            font-weight: 800;
            font-variant-numeric: tabular-nums;
            opacity: 0.95;
        }

        .refresh-btn {
            width: 40px;
            height: 40px;
            border-radius: var(--radius-md);
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid rgba(255,255,255,0.3);
            background: rgba(255,255,255,0.15);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(4px);
            -webkit-backdrop-filter: blur(4px);
        }

        .refresh-btn:hover {
            background: rgba(255,255,255,0.3);
        }

        .refresh-btn.refreshing {
            animation: spin 1s linear infinite;
            background: rgba(255,255,255,0.25);
            border-color: rgba(255,255,255,0.5);
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        /* ================================================================
           BOTTOM TAB NAVIGATION â€” fixed at bottom for thumb reach
           ================================================================ */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            z-index: 200;
            background: var(--bg-white);
            border-top: 1px solid var(--border-light);
            display: flex;
            align-items: stretch;
            height: var(--bottom-nav-height);
            padding-bottom: var(--safe-bottom);
            box-shadow: 0 -4px 20px rgba(0,0,0,0.06);
        }

        .bottom-tab {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 2px;
            border: none;
            background: transparent;
            cursor: pointer;
            color: var(--text-muted);
            font-family: inherit;
            font-size: 0.65rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.04em;
            transition: color 0.2s ease;
            position: relative;
        }

        .bottom-tab .tab-icon {
            font-size: 1.35rem;
            line-height: 1;
            transition: transform 0.2s ease;
        }

        .bottom-tab.active {
            color: var(--brand-blue);
        }

        .bottom-tab.active .tab-icon {
            transform: scale(1.1);
        }

        /* Active indicator pill */
        .bottom-tab.active::before {
            content: '';
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 32px;
            height: 3px;
            background: var(--brand-blue);
            border-radius: 0 0 3px 3px;
        }

        .bottom-tab:active {
            transform: scale(0.92);
        }

        /* Action buttons in bottom nav */
        .bottom-nav-actions {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 0 8px;
        }

        .bottom-action-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 42px;
            height: 42px;
            border-radius: var(--radius-md);
            border: none;
            cursor: pointer;
            font-size: 1rem;
            font-family: inherit;
            font-weight: 700;
            transition: all 0.2s ease;
        }

        .bottom-action-btn.transfer {
            background: var(--success-green);
            color: white;
        }

        .bottom-action-btn.save {
            background: var(--brand-gradient);
            color: white;
        }

        .bottom-action-btn:active {
            transform: scale(0.9);
        }

        /* Hide the old tab-nav on mobile (replaced by bottom nav) */
        .tab-nav {
            display: none;
        }

        /* ================================================================
           BUTTONS
           ================================================================ */
        .btn {
            padding: 0.6rem 1.1rem;
            font-size: 0.9rem;
            font-weight: 700;
            border: none;
            border-radius: var(--radius-sm);
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.4rem;
            transition: all 0.2s ease;
            font-family: inherit;
            min-height: 44px;
        }

        .btn-primary {
            background: var(--brand-gradient);
            color: white;
            box-shadow: 0 2px 8px rgba(0, 172, 238, 0.25);
        }

        .btn-primary:hover {
            box-shadow: 0 4px 12px rgba(0, 172, 238, 0.35);
        }

        .btn-success {
            background: var(--success-green);
            color: white;
            box-shadow: 0 2px 8px rgba(34, 197, 94, 0.25);
        }

        .btn-success:hover {
            background: #16a34a;
        }

        .btn-outline {
            background: transparent;
            border: 2px solid var(--border-light);
            color: var(--text-dark);
        }

        .btn-outline:hover {
            border-color: var(--brand-blue);
            color: var(--brand-blue);
        }

        .btn-danger {
            background: var(--danger-red);
            color: white;
        }

        .btn-danger:hover {
            background: #dc2626;
        }

        .btn-small {
            padding: 0.35rem 0.7rem;
            font-size: 0.8rem;
            min-height: 36px;
        }

        /* ================================================================
           TAB CONTENT
           ================================================================ */
        .tab-content {
            display: none;
            padding: 0.75rem;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.2s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(4px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* ================================================================
           STAGING AREA â€” Collapsible on mobile
           ================================================================ */
        .staging-area {
            background: var(--bg-white);
            border-radius: var(--radius-lg);
            margin-bottom: 0.75rem;
            box-shadow: var(--shadow-card);
            overflow: hidden;
            border: 1px solid var(--border-light);
        }

        .staging-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.85rem 1rem;
            cursor: pointer;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
        }

        .staging-title {
            font-size: 1rem;
            font-weight: 800;
            color: var(--text-dark);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .staging-count {
            background: var(--brand-blue);
            color: white;
            padding: 0.15rem 0.55rem;
            border-radius: var(--radius-full);
            font-size: 0.75rem;
            font-weight: 800;
            min-width: 24px;
            text-align: center;
        }

        .staging-chevron {
            font-size: 0.85rem;
            color: var(--text-muted);
            transition: transform 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.4rem;
        }

        .staging-chevron .chevron-icon {
            transition: transform 0.3s ease;
        }

        .staging-area.expanded .staging-chevron .chevron-icon {
            transform: rotate(180deg);
        }

        .staging-body {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.35s ease, padding 0.35s ease;
            padding: 0 1rem;
        }

        .staging-area.expanded .staging-body {
            max-height: 600px;
            padding: 0 1rem 1rem;
        }

        .staging-input-row {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 0.75rem;
        }

        .staging-input {
            flex: 1 1 100%;
            padding: 0.75rem 1rem;
            font-size: 16px;
            border: 2px solid var(--border-light);
            border-radius: var(--radius-sm);
            font-family: inherit;
            font-weight: 600;
            min-height: 48px;
            background: var(--bg-light);
            transition: border-color 0.2s ease, background 0.2s ease;
        }

        .staging-input:focus {
            outline: none;
            border-color: var(--brand-blue);
            background: white;
        }

        .service-type-select {
            flex: 1 1 0;
            min-width: 0;
            padding: 0.75rem 0.75rem;
            border: 2px solid var(--border-light);
            border-radius: var(--radius-sm);
            font-size: 16px;
            font-family: inherit;
            font-weight: 600;
            background: white;
            cursor: pointer;
            min-height: 48px;
        }

        .service-type-select:focus {
            outline: none;
            border-color: var(--brand-blue);
        }

        .staging-dogs {
            display: flex;
            flex-wrap: wrap;
            gap: 0.4rem;
            min-height: 48px;
            padding: 0.75rem;
            background: var(--bg-light);
            border-radius: var(--radius-sm);
            border: 2px dashed var(--border-light);
        }

        .staging-dogs:empty::before {
            content: 'Type a name above and press Enter or tap Add';
            color: var(--text-light);
            font-style: italic;
            font-size: 0.85rem;
        }

        .staged-dog {
            display: inline-flex;
            align-items: center;
            gap: 0.4rem;
            background: var(--brand-gradient);
            color: white;
            padding: 0.45rem 0.65rem;
            border-radius: var(--radius-sm);
            font-weight: 700;
            font-size: 0.9rem;
            animation: popIn 0.2s ease;
        }

        @keyframes popIn {
            from { transform: scale(0.8); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .staged-dog-remove {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.2s ease;
            position: relative;
        }

        /* Expanded touch target */
        .staged-dog-remove::before {
            content: '';
            position: absolute;
            top: -8px;
            left: -8px;
            right: -8px;
            bottom: -8px;
        }

        .staged-dog-remove:hover {
            background: rgba(255,255,255,0.4);
        }

        .staging-actions {
            display: flex;
            gap: 0.5rem;
            margin-top: 0.75rem;
            justify-content: flex-end;
        }

        /* ================================================================
           STATS BAR â€” Horizontal scrollable chips
           ================================================================ */
        .stats-bar {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 0.75rem;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none;
            padding: 2px;
        }

        .stats-bar::-webkit-scrollbar {
            display: none;
        }

        .stat-card {
            background: var(--bg-white);
            border-radius: var(--radius-md);
            padding: 0.6rem 0.85rem;
            box-shadow: var(--shadow-card);
            display: flex;
            align-items: center;
            gap: 0.6rem;
            flex-shrink: 0;
            min-width: 0;
        }

        .stat-icon {
            width: 36px;
            height: 36px;
            border-radius: var(--radius-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.15rem;
            flex-shrink: 0;
        }

        .stat-icon.dogs { background: #dbeafe; }
        .stat-icon.photos { background: #dcfce7; }
        .stat-icon.walks { background: #fef3c7; }
        .stat-icon.vans { background: #f3e8ff; }

        .stat-value {
            font-size: 1.35rem;
            font-weight: 900;
            line-height: 1;
        }

        .stat-label {
            font-size: 0.65rem;
            color: var(--text-muted);
            font-weight: 600;
            white-space: nowrap;
        }

        /* ================================================================
           VAN LEGEND â€” Collapsible accordion
           ================================================================ */
        .van-legend {
            background: var(--bg-white);
            border-radius: var(--radius-md);
            margin-bottom: 0.75rem;
            box-shadow: var(--shadow-card);
            overflow: hidden;
            border: 1px solid var(--border-light);
        }

        .van-legend-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.7rem 1rem;
            cursor: pointer;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
            font-weight: 800;
            font-size: 0.85rem;
            color: var(--text-dark);
        }

        .van-legend-header .van-chevron {
            transition: transform 0.3s ease;
            color: var(--text-muted);
            font-size: 0.85rem;
        }

        .van-legend.expanded .van-chevron {
            transform: rotate(180deg);
        }

        .van-legend-body {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.35s ease;
        }

        .van-legend.expanded .van-legend-body {
            max-height: 400px;
        }

        .van-legend-content {
            padding: 0 1rem 0.85rem;
            display: flex;
            flex-direction: column;
            gap: 0.6rem;
        }

        .van-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 600;
            font-size: 0.85rem;
        }

        .van-badge {
            padding: 0.2rem 0.6rem;
            border-radius: var(--radius-sm);
            font-size: 0.75rem;
            font-weight: 800;
            min-width: 32px;
            text-align: center;
        }

        .van-badge.bv { background: #dbeafe; color: #1d4ed8; }
        .van-badge.dv { background: #fef3c7; color: #b45309; }
        .van-badge.sv { background: #dcfce7; color: #15803d; }

        .van-time-select {
            padding: 0.35rem 0.5rem;
            border: 2px solid var(--border-light);
            border-radius: var(--radius-sm);
            font-size: 16px;
            font-family: inherit;
            font-weight: 600;
            cursor: pointer;
            background: white;
            min-height: 40px;
        }

        .van-time-select:focus {
            outline: none;
            border-color: var(--brand-blue);
        }

        .walk-legend {
            display: flex;
            gap: 0.75rem;
            padding-top: 0.5rem;
            border-top: 1px solid var(--border-light);
            font-size: 0.8rem;
            font-weight: 700;
        }

        /* ================================================================
           BOARD CONTAINER
           ================================================================ */
        .board-container {
            display: grid;
            gap: 0.75rem;
        }

        /* Mobile: always single column */
        .board-container.cols-1,
        .board-container.cols-2,
        .board-container.cols-3,
        .board-container.cols-4,
        .board-container.cols-5,
        .board-container.cols-6 {
            grid-template-columns: 1fr;
        }

        /* Board Column */
        .board-column {
            background: var(--bg-white);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-light);
            overflow: clip;
        }

        /* ================================================================
           SERVICE SECTIONS
           ================================================================ */
        .service-section {
            margin-bottom: 0.75rem;
        }

        .service-section:last-child {
            margin-bottom: 0;
        }

        .section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.7rem 1rem;
            font-weight: 800;
            font-size: 0.9rem;
            border-radius: var(--radius-md) var(--radius-md) 0 0;
            margin-bottom: 0;
        }

        .section-header .section-icon {
            margin-right: 0.4rem;
        }

        .section-header .section-count {
            background: rgba(255,255,255,0.3);
            padding: 0.15rem 0.6rem;
            border-radius: var(--radius-full);
            font-size: 0.7rem;
            font-weight: 800;
        }

        /* Half Day AM - Orange/Amber */
        .section-header.half-day-am {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
        }
        .section-row.half-day-am {
            background: #fffbeb;
            border-left: 4px solid #f59e0b;
        }

        /* Full Day - Blue */
        .section-header.full-day {
            background: var(--brand-gradient);
            color: white;
        }
        .section-row.full-day {
            background: white;
            border-left: 4px solid var(--brand-blue);
        }

        /* Boarding - Purple */
        .section-header.boarding {
            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
            color: white;
        }
        .section-row.boarding {
            background: #f5f3ff;
            border-left: 4px solid #8b5cf6;
        }

        /* Grooming - Teal */
        .section-header.grooming {
            background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%);
            color: white;
        }
        .section-row.grooming {
            background: #ecfeff;
            border-left: 4px solid #06b6d4;
        }

        /* Boarding School - Rose */
        .section-header.boarding-school {
            background: linear-gradient(135deg, #f43f5e 0%, #e11d48 100%);
            color: white;
        }
        .section-row.boarding-school {
            background: #fff1f2;
            border-left: 4px solid #f43f5e;
        }

        /* ===== Boarding Parent Container ===== */
        .boarding-parent-section {
            margin-bottom: 0.75rem;
        }

        .section-header.boarding-parent {
            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
            color: white;
        }

        .boarding-subsections {
            border-left: 3px solid #8b5cf6;
            border-right: 1px solid var(--border-light);
            border-bottom: 1px solid var(--border-light);
            border-radius: 0 0 var(--radius-md) var(--radius-md);
            overflow: hidden;
            background: #faf9ff;
        }

        .boarding-sub-section + .boarding-sub-section {
            border-top: 2px solid var(--border-light);
        }

        .boarding-sub-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.5rem 1rem;
            font-weight: 800;
            font-size: 0.8rem;
            color: white;
        }

        .boarding-sub-header .section-icon {
            margin-right: 0.35rem;
        }

        .boarding-sub-header .section-count {
            background: rgba(255,255,255,0.3);
            padding: 0.1rem 0.5rem;
            border-radius: var(--radius-full);
            font-size: 0.65rem;
            font-weight: 800;
        }

        .boarding-sub-header.boarding-hol-sub {
            background: linear-gradient(135deg, #a78bfa 0%, #8b5cf6 100%);
        }

        .boarding-sub-header.boarding-school-sub {
            background: linear-gradient(135deg, #fb7185 0%, #f43f5e 100%);
        }

        .boarding-header-stats {
            display: flex;
            align-items: center;
            gap: 0.4rem;
            flex-shrink: 0;
        }

        .crate-summary {
            background: rgba(255,255,255,0.2);
            padding: 0.15rem 0.5rem;
            border-radius: var(--radius-full);
            font-size: 0.6rem;
            font-weight: 800;
            white-space: nowrap;
        }

        /* ================================================================
           SECTION CONTENT & TABLE HEADER
           ================================================================ */
        .section-content {
            background: var(--bg-white);
            border: 1px solid var(--border-light);
            border-top: none;
            border-radius: 0 0 var(--radius-md) var(--radius-md);
            overflow: clip;
        }

        /* Table headers hidden on mobile â€” card layout uses inline cues */
        .table-header,
        .table-header.boarding-header,
        .table-header.grooming-header,
        .table-header.boarding-school-header {
            display: none;
        }

        .column-header {
            background: var(--brand-gradient);
            color: white;
            padding: 0.65rem 1rem;
            font-weight: 700;
            font-size: 0.9rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .column-count {
            background: rgba(255,255,255,0.2);
            padding: 0.2rem 0.6rem;
            border-radius: var(--radius-full);
            font-size: 0.8rem;
        }

        /* ================================================================
           DOG ROWS â€” Mobile Card Layout
           ================================================================ */
        .dog-rows {
            max-height: none !important;
            overflow: visible !important;
            height: auto !important;
        }

        /* 
           Mobile Card Grid:
           Row 1: Name | Photo âœ“ | Walk | Delete Ã—
           Row 2: VP Controls (AM/PM) | Notes toggle ðŸ“
           Row 3 (conditional): Full-width notes input
        */
        .dog-row {
            display: grid;
            grid-template-columns: 1fr 48px minmax(80px, 110px) 44px;
            grid-template-rows: auto auto 0fr;
            gap: 0.35rem 0.3rem;
            padding: 0.7rem 0.75rem 0.6rem;
            margin: 0.35rem 0.4rem;
            border-radius: var(--radius-md);
            border-width: 1px;
            border-style: solid;
            border-color: var(--border-light);
            border-left-width: 5px;
            box-shadow: var(--shadow-xs);
            transition: grid-template-rows 0.25s ease, box-shadow 0.2s ease;
            background: white;
        }

        /* When notes expanded, row 3 opens */
        .dog-row.notes-expanded {
            grid-template-rows: auto auto 1fr;
            box-shadow: var(--shadow-md);
        }

        /* Row 1 placement */
        .dog-row .dog-name {
            grid-column: 1;
            grid-row: 1;
            font-size: 1.05rem;
            font-weight: 800;
            align-self: center;
            color: var(--text-dark);
            padding: 0.2rem 0;
            letter-spacing: -0.01em;
        }

        .dog-row .photo-check {
            grid-column: 2;
            grid-row: 1;
            align-self: center;
            justify-self: center;
            position: relative;
        }

        /* Mobile inline label: Camera icon above checkbox */
        .dog-row .photo-check::before {
            content: 'ðŸ“¸';
            position: absolute;
            top: -13px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.55rem;
            color: var(--text-light);
            white-space: nowrap;
        }

        .dog-row .walk-select {
            grid-column: 3;
            grid-row: 1;
            align-self: center;
        }

        .dog-row .delete-btn {
            grid-column: 4;
            grid-row: 1;
            justify-self: center;
            align-self: center;
        }

        /* Row 2: VP Controls + Notes Toggle */
        .dog-row .vp-control {
            grid-column: 1 / 4;
            grid-row: 2;
            padding-top: 0.45rem;
            margin-top: 0.2rem;
            border-top: 1px solid var(--border-light);
            flex-wrap: nowrap;
            justify-content: flex-start;
        }

        /* AM/PM labels */
        .vp-group-label {
            display: block !important;
            font-size: 0.55rem;
            font-weight: 800;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-right: 2px;
            flex-shrink: 0;
            min-width: 18px;
        }

        /* AM/PM divider bar */
        .vp-divider {
            width: 2px;
            height: 32px;
            background: var(--border-medium);
            margin: 0 6px;
            border-radius: 2px;
            opacity: 0.5;
        }

        .vp-group > select {
            flex-shrink: 0;
        }

        /* Notes toggle â€” mobile visible */
        .notes-toggle {
            display: flex !important;
            grid-column: 4;
            grid-row: 2;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            justify-self: center;
            align-self: center;
            gap: 2px;
            cursor: pointer;
            -webkit-tap-highlight-color: transparent;
        }

        .notes-toggle-label {
            font-size: 0.6rem;
            line-height: 1;
        }

        /* Toggle track */
        .toggle-track {
            width: 36px;
            height: 20px;
            background: #cbd5e1;
            border-radius: 10px;
            position: relative;
            transition: background 0.25s ease;
            flex-shrink: 0;
        }

        /* Toggle knob */
        .toggle-knob {
            width: 16px;
            height: 16px;
            background: white;
            border-radius: 50%;
            position: absolute;
            top: 2px;
            left: 2px;
            transition: transform 0.25s ease;
            box-shadow: 0 1px 3px rgba(0,0,0,0.25);
        }

        .notes-toggle:active .toggle-knob {
            width: 20px;
            border-radius: 8px;
        }

        /* ON state */
        .dog-row.notes-expanded .toggle-track {
            background: #22c55e;
        }
        .dog-row.notes-expanded .toggle-knob {
            transform: translateX(16px);
        }
        .dog-row.notes-expanded .notes-toggle:active .toggle-knob {
            transform: translateX(12px);
        }

        /* Has notes but closed â€” amber track */
        .notes-toggle.has-notes .toggle-track {
            background: #f59e0b;
        }
        /* Expanded overrides amber */
        .dog-row.notes-expanded .notes-toggle.has-notes .toggle-track {
            background: #22c55e;
        }

        /* Row 3: Notes input (conditional) */
        .dog-row .notes-input {
            grid-column: 1 / 5;
            grid-row: 3;
            font-size: 16px;
            overflow: hidden;
            opacity: 0;
            min-height: 0;
            padding: 0;
            margin: 0;
            border-width: 0;
            transition: all 0.25s ease;
            border-radius: var(--radius-sm);
            font-family: inherit;
            font-weight: 600;
        }

        .dog-row.notes-expanded .notes-input {
            opacity: 1;
            min-height: 44px;
            padding: 0.5rem;
            margin-top: 0.2rem;
            border-width: 2px;
            border-style: solid;
            border-color: var(--border-light);
        }

        /* ===== Boarding Mobile Layout ===== */
        .dog-row.boarding {
            grid-template-columns: 1fr 48px minmax(80px, 110px) 44px;
        }

        .dog-row.boarding .vp-control-am {
            grid-column: 1 / 2;
            grid-row: 2;
            padding-top: 0.45rem;
            margin-top: 0.2rem;
            border-top: 1px solid var(--border-light);
        }

        .dog-row.boarding .crate-select {
            grid-column: 2 / 4;
            grid-row: 2;
            align-self: center;
            justify-self: stretch;
            width: auto;
            min-height: 44px;
            font-size: 16px;
            font-family: inherit;
            font-weight: 700;
            padding: 0.35rem 0.3rem;
            margin-top: 0.2rem;
            border-top: 1px solid var(--border-light);
            padding-top: 0.45rem;
            border-radius: var(--radius-sm);
        }

        .dog-row.boarding .walk-select {
            grid-column: 3;
            grid-row: 1;
        }

        .dog-row.boarding .notes-toggle {
            grid-column: 4;
            grid-row: 2;
            justify-self: center;
            margin-top: 0.2rem;
            border-top: 1px solid var(--border-light);
            padding-top: 0.45rem;
        }

        .dog-row.boarding .boarding-checkin {
            grid-column: 1 / 3;
            grid-row: 3;
            padding-top: 0.45rem;
            margin-top: 0.2rem;
            border-top: 1px solid var(--border-light);
        }

        .dog-row.boarding .boarding-checkout {
            grid-column: 3 / 5;
            grid-row: 3;
            padding-top: 0.45rem;
            margin-top: 0.2rem;
            border-top: 1px solid var(--border-light);
        }

        .dog-row.boarding .boarding-checkin .boarding-date-input,
        .dog-row.boarding .boarding-checkout .boarding-date-input {
            min-height: 44px;
            font-size: 16px;
        }

        .dog-row.boarding .notes-input {
            grid-column: 1 / 5;
            grid-row: 4;
        }

        /* Notes expanded for boarding â€” 4-row grid */
        .dog-row.boarding.notes-expanded {
            grid-template-rows: auto auto auto 1fr;
        }
        .dog-row.boarding:not(.notes-expanded) {
            grid-template-rows: auto auto auto 0fr;
        }

        /* ===== Grooming Mobile ===== */
        .dog-row.grooming {
            grid-template-columns: 1fr 1fr 70px 44px;
            grid-template-rows: auto auto;
            gap: 0.35rem;
        }

        .dog-row.grooming .dog-name {
            grid-column: 1 / 4;
            grid-row: 1;
            font-size: 1.05rem;
            font-weight: 800;
            align-self: center;
        }

        .dog-row.grooming .delete-btn {
            grid-column: 4;
            grid-row: 1;
            justify-self: center;
            align-self: center;
        }

        .dog-row.grooming .grooming-pickup {
            grid-column: 1;
            grid-row: 2;
            padding-top: 0.45rem;
            margin-top: 0.2rem;
            border-top: 1px solid var(--border-light);
            min-height: 44px;
            font-size: 16px;
        }

        .dog-row.grooming .grooming-dropoff {
            grid-column: 2;
            grid-row: 2;
            padding-top: 0.45rem;
            margin-top: 0.2rem;
            border-top: 1px solid var(--border-light);
            min-height: 44px;
            font-size: 16px;
        }

        .dog-row.grooming .grooming-van-select {
            grid-column: 3;
            grid-row: 2;
            padding-top: 0.45rem;
            margin-top: 0.2rem;
            border-top: 1px solid var(--border-light);
            min-height: 44px;
            font-size: 16px;
        }

        /* ===== Boarding School Mobile ===== */
        .dog-row.boarding-school {
            grid-template-columns: 1fr 1fr 80px 44px;
            grid-template-rows: auto auto;
            gap: 0.35rem;
        }

        .dog-row.boarding-school .dog-name {
            grid-column: 1 / 4;
            grid-row: 1;
            font-size: 1.05rem;
            font-weight: 800;
            align-self: center;
        }

        .dog-row.boarding-school .delete-btn {
            grid-column: 4;
            grid-row: 1;
            justify-self: center;
            align-self: center;
        }

        .dog-row.boarding-school .bs-checkin {
            grid-column: 1;
            grid-row: 2;
            padding-top: 0.45rem;
            margin-top: 0.2rem;
            border-top: 1px solid var(--border-light);
        }

        .dog-row.boarding-school .bs-checkout {
            grid-column: 2;
            grid-row: 2;
            padding-top: 0.45rem;
            margin-top: 0.2rem;
            border-top: 1px solid var(--border-light);
        }

        .dog-row.boarding-school .bs-checkin .bs-date-input,
        .dog-row.boarding-school .bs-checkout .bs-date-input {
            min-height: 44px;
            font-size: 16px;
        }

        .dog-row.boarding-school .bs-crate-select {
            grid-column: 3;
            grid-row: 2;
            padding-top: 0.45rem;
            margin-top: 0.2rem;
            border-top: 1px solid var(--border-light);
            min-height: 44px;
            font-size: 16px;
        }

        /* ================================================================
           FORM CONTROLS â€” All touch-optimised
           ================================================================ */
        .photo-check {
            display: flex;
            justify-content: center;
        }

        .photo-checkbox {
            width: 44px;
            height: 44px;
            appearance: none;
            -webkit-appearance: none;
            border: 2px solid var(--border-light);
            border-radius: var(--radius-sm);
            cursor: pointer;
            position: relative;
            transition: all 0.2s ease;
            background: var(--bg-light);
        }

        .photo-checkbox:checked {
            background: var(--success-green);
            border-color: var(--success-green);
        }

        .photo-checkbox:checked::after {
            content: 'âœ“';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 1.3rem;
            font-weight: 800;
        }

        /* Walk Select */
        .walk-select {
            width: 100%;
            padding: 0.5rem 0.4rem;
            border: 2px solid var(--border-light);
            border-radius: var(--radius-sm);
            font-size: 16px;
            font-family: inherit;
            font-weight: 600;
            cursor: pointer;
            background: white;
            min-height: 44px;
        }

        .walk-select:focus {
            outline: none;
            border-color: var(--brand-blue);
        }

        .walk-select.walk-booked {
            background: #fef3c7;
            border-color: var(--warning-amber);
        }

        .walk-select.walk-transferred {
            background: #dcfce7;
            border-color: var(--success-green);
        }

        /* VP Control */
        .vp-control {
            display: flex;
            align-items: center;
            gap: 0;
        }

        .vp-select {
            width: 44px;
            min-height: 44px;
            padding: 0.4rem 0.15rem;
            border: 2px solid var(--border-light);
            border-radius: 0;
            font-size: 16px;
            font-family: inherit;
            font-weight: 700;
            cursor: pointer;
            background: white;
            text-align: center;
            appearance: none;
            -webkit-appearance: none;
        }

        .vp-select.vp-am { border-left: none; }
        .vp-select.vp-pm { border-left: none; }

        .vp-select:focus {
            outline: none;
            border-color: var(--brand-blue);
            z-index: 1;
        }

        /* Van pickup styles */
        .vp-select.van-pickup,
        .vp-select.van-bv {
            background: #dbeafe;
            border-color: #3b82f6;
            color: #1e40af;
            z-index: 1;
        }
        .vp-select.van-sv {
            background: #d1fae5;
            border-color: #10b981;
            color: #065f46;
            z-index: 1;
        }
        .vp-select.van-dv {
            background: #fef3c7;
            border-color: #f59e0b;
            color: #92400e;
            z-index: 1;
        }
        .vp-select.parent-pickup {
            background: #f3e8ff;
            border-color: #a855f7;
            color: #7c3aed;
            z-index: 1;
        }

        /* Stop selects */
        .stop-select {
            width: 40px;
            min-height: 44px;
            padding: 0.4rem 0.15rem;
            border: 2px solid var(--border-light);
            font-size: 16px;
            font-family: inherit;
            font-weight: 700;
            text-align: center;
            background: white;
            cursor: pointer;
            appearance: none;
            -webkit-appearance: none;
        }

        .stop-select.stop-am {
            border-radius: var(--radius-sm) 0 0 var(--radius-sm);
        }

        .stop-select.stop-pm {
            border-radius: 0 var(--radius-sm) var(--radius-sm) 0;
            border-left: none;
        }

        .stop-select:focus {
            outline: none;
            border-color: var(--brand-blue);
            z-index: 1;
        }

        .stop-select:disabled {
            background: #f1f5f9;
            color: #94a3b8;
            cursor: not-allowed;
        }

        .stop-select.has-value:not(:disabled) {
            background: #dbeafe;
            border-color: #3b82f6;
            color: #1e40af;
            z-index: 1;
        }

        /* Notes Input */
        .notes-input {
            width: 100%;
            padding: 0.5rem;
            border: 2px solid var(--border-light);
            border-radius: var(--radius-sm);
            font-size: 16px;
            font-family: inherit;
            font-weight: 600;
            transition: border-color 0.2s ease;
        }

        .notes-input:focus {
            outline: none;
            border-color: var(--brand-blue);
        }

        .notes-input:not(:placeholder-shown) {
            background: #fffbeb;
            border-color: var(--warning-amber);
        }

        /* Delete Button */
        .delete-btn {
            width: 44px;
            height: 44px;
            border: none;
            background: #fee2e2;
            color: var(--danger-red);
            cursor: pointer;
            border-radius: var(--radius-sm);
            font-size: 1.3rem;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .delete-btn:hover {
            background: var(--danger-red);
            color: white;
        }

        /* Grooming select styling */
        .grooming-select {
            width: 100%;
            padding: 0.4rem 0.25rem;
            border: 2px solid var(--border-light);
            border-radius: var(--radius-sm);
            font-size: 0.8rem;
            font-family: inherit;
            font-weight: 600;
            background: white;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .grooming-select:focus {
            border-color: #06b6d4;
            outline: none;
            box-shadow: 0 0 0 3px rgba(6, 182, 212, 0.15);
        }

        .grooming-select.has-value {
            background: #ecfeff;
            border-color: #06b6d4;
            color: #0e7490;
        }

        /* Grooming van type select */
        .grooming-van-select {
            width: 100%;
            padding: 0.4rem 0.25rem;
            border: 2px solid var(--border-light);
            border-radius: var(--radius-sm);
            font-size: 0.8rem;
            font-family: inherit;
            font-weight: 700;
            background: white;
            cursor: pointer;
            text-align: center;
            transition: all 0.2s ease;
        }

        .grooming-van-select:focus {
            border-color: #06b6d4;
            outline: none;
        }

        .grooming-van-select.has-value {
            background: #ecfeff;
            border-color: #06b6d4;
            color: #0e7490;
        }

        /* Boarding School date inputs */
        .bs-date-input {
            width: 100%;
            padding: 0.4rem 0.25rem;
            border: 2px solid var(--border-light);
            border-radius: var(--radius-sm);
            font-size: 0.8rem;
            font-family: inherit;
            font-weight: 600;
            background: white;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .bs-date-input:focus {
            border-color: #f43f5e;
            outline: none;
        }

        .bs-date-input:not(:placeholder-shown),
        .bs-date-input.has-value {
            background: #fff1f2;
            border-color: #f43f5e;
            color: #be123c;
        }

        /* Boarding School crate select */
        .bs-crate-select {
            width: 100%;
            padding: 0.4rem 0.25rem;
            border: 2px solid var(--border-light);
            border-radius: var(--radius-sm);
            font-size: 0.8rem;
            font-family: inherit;
            font-weight: 700;
            background: white;
            cursor: pointer;
            text-align: center;
            transition: all 0.2s ease;
        }

        .bs-crate-select:focus {
            border-color: #f43f5e;
            outline: none;
        }

        .bs-crate-select.has-value {
            background: #fff1f2;
            border-color: #f43f5e;
            color: #be123c;
        }

        /* Crate select */
        .crate-select {
            width: 100%;
            padding: 0.4rem 0.25rem;
            border: 2px solid var(--border-light);
            border-radius: var(--radius-sm);
            font-size: 0.8rem;
            font-family: inherit;
            font-weight: 700;
            background: white;
            cursor: pointer;
            text-align: center;
            transition: all 0.2s ease;
        }

        .crate-select:focus {
            border-color: #8b5cf6;
            outline: none;
        }

        .crate-select.has-value {
            background: #f5f3ff;
            border-color: #8b5cf6;
            color: #6d28d9;
        }

        /* Boarding date input */
        .boarding-date-input {
            width: 100%;
            padding: 0.4rem 0.25rem;
            border: 2px solid var(--border-light);
            border-radius: var(--radius-sm);
            font-size: 0.75rem;
            font-family: inherit;
            font-weight: 600;
            background: white;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .boarding-date-input:focus {
            border-color: #8b5cf6;
            outline: none;
        }

        .boarding-date-input.has-value {
            background: #f5f3ff;
            border-color: #8b5cf6;
            color: #6d28d9;
        }

        /* Date-with-day container */
        .date-with-day {
            display: flex;
            flex-direction: column;
            gap: 2px;
            width: 100%;
        }

        .date-with-day .day-label {
            font-size: 0.65rem;
            font-weight: 700;
            text-align: center;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            line-height: 1;
            opacity: 0;
            transition: opacity 0.2s ease;
            height: 0;
            overflow: hidden;
        }

        .date-with-day .day-label.visible {
            opacity: 1;
            height: auto;
            padding-top: 2px;
        }

        .boarding .day-label { color: #7c3aed; }
        .boarding-school .day-label { color: #e11d48; }

        /* Boarding AM-only VP control */
        .vp-control-am {
            display: flex;
            align-items: center;
            gap: 0;
        }

        /* ================================================================
           EMPTY STATE
           ================================================================ */
        .empty-board {
            text-align: center;
            padding: 3rem 1.5rem;
            color: var(--text-muted);
        }

        .empty-board-icon {
            font-size: 3rem;
            margin-bottom: 0.75rem;
        }

        .empty-board-text {
            font-size: 1rem;
            font-weight: 700;
            margin-bottom: 0.35rem;
        }

        .empty-board-hint {
            font-size: 0.85rem;
            opacity: 0.7;
        }

        /* ================================================================
           MODAL
           ================================================================ */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(4px);
            -webkit-backdrop-filter: blur(4px);
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal {
            background: white;
            border-radius: var(--radius-xl);
            padding: 1.5rem;
            max-width: 360px;
            width: calc(100% - 2rem);
            box-shadow: var(--shadow-lg);
            animation: modalPop 0.2s ease;
        }

        @keyframes modalPop {
            from { transform: scale(0.95); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .modal-title {
            font-size: 1.15rem;
            font-weight: 900;
            margin-bottom: 0.75rem;
        }

        .modal-text {
            color: var(--text-muted);
            margin-bottom: 1.25rem;
            font-size: 0.9rem;
            line-height: 1.5;
        }

        .modal-actions {
            display: flex;
            gap: 0.5rem;
            justify-content: flex-end;
        }

        /* ================================================================
           TOAST NOTIFICATIONS
           ================================================================ */
        .toast-container {
            position: fixed;
            /* Above bottom nav */
            bottom: calc(var(--bottom-nav-height) + var(--safe-bottom) + 12px);
            left: 0.75rem;
            right: 0.75rem;
            z-index: 1001;
            display: flex;
            flex-direction: column;
            gap: 0.4rem;
        }

        .toast {
            background: var(--text-dark);
            color: white;
            padding: 0.75rem 1rem;
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-lg);
            animation: slideUp 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .toast.success { background: var(--success-green); }
        .toast.error { background: var(--danger-red); }

        @keyframes slideUp {
            from { transform: translateY(100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        /* ================================================================
           VERY SMALL PHONES (< 400px)
           ================================================================ */
        @media (max-width: 400px) {
            .dog-row {
                grid-template-columns: 1fr 44px minmax(70px, 90px) 40px;
                padding: 0.55rem 0.5rem;
            }

            .dog-row.boarding {
                grid-template-columns: 1fr 44px minmax(70px, 90px) 40px;
            }

            .dog-row.grooming {
                grid-template-columns: 1fr 1fr 60px 40px;
            }

            .dog-row.boarding-school {
                grid-template-columns: 1fr 1fr 70px 40px;
            }

            .dog-row .dog-name,
            .dog-row.grooming .dog-name,
            .dog-row.boarding-school .dog-name {
                font-size: 0.9rem;
            }

            .header-subtitle {
                display: none;
            }

            .stat-value {
                font-size: 1.15rem;
            }

            .stat-icon {
                width: 30px;
                height: 30px;
                font-size: 1rem;
            }
        }

        /* ================================================================
           TABLET & DESKTOP (min-width: 768px) â€” Scale UP
           ================================================================ */
        @media (min-width: 768px) {
            body {
                padding-bottom: 0;
            }

            /* Hide bottom nav on tablet/desktop */
            .bottom-nav {
                display: none;
            }

            /* Show classic tab nav */
            .tab-nav {
                display: flex;
                background: var(--bg-white);
                border-bottom: 2px solid var(--border-light);
                padding: 0 1rem;
            }

            .tab-btn {
                padding: 1rem 2rem;
                font-size: 1.1rem;
                font-weight: 700;
                border: none;
                background: transparent;
                cursor: pointer;
                color: var(--text-muted);
                border-bottom: 3px solid transparent;
                margin-bottom: -2px;
                transition: all 0.2s ease;
                font-family: inherit;
            }

            .tab-btn:hover { color: var(--brand-blue); }

            .tab-btn.active {
                color: var(--brand-blue);
                border-bottom-color: var(--brand-blue);
            }

            .tab-actions {
                margin-left: auto;
                display: flex;
                align-items: center;
                gap: 0.5rem;
                padding: 0.5rem 0;
            }

            /* Header larger */
            .header {
                padding: 1rem 1.5rem;
                padding-top: calc(1rem + var(--safe-top));
            }

            .logo {
                width: 50px;
                height: 50px;
            }

            .header-title {
                font-size: 1.5rem;
            }

            .header-subtitle {
                font-size: 0.875rem;
            }

            .current-time {
                font-size: 1.25rem;
            }

            .refresh-btn {
                width: 44px;
                height: 44px;
                font-size: 1.2rem;
                background: #f59e0b;
                border: 2px solid #fbbf24;
                color: white;
                backdrop-filter: none;
            }

            .refresh-btn:hover {
                background: #d97706;
                border-color: #d97706;
                transform: rotate(180deg);
            }

            /* Tab content padding */
            .tab-content {
                padding: 1rem;
            }

            /* Staging area always expanded on tablet */
            .staging-area .staging-body {
                max-height: 600px !important;
                padding: 0 1rem 1rem !important;
            }

            .staging-chevron {
                display: none;
            }

            .staging-area {
                padding: 0;
            }

            .staging-header {
                cursor: default;
            }

            .staging-input-row {
                flex-wrap: nowrap;
            }

            .staging-input {
                flex: 1 1 auto;
            }

            /* Van legend always expanded */
            .van-legend .van-legend-body {
                max-height: 400px !important;
            }

            .van-legend-header .van-chevron {
                display: none;
            }

            .van-legend-content {
                flex-direction: row;
                flex-wrap: wrap;
                align-items: center;
            }

            /* Stats bar wraps nicely */
            .stats-bar {
                flex-wrap: wrap;
            }

            .stat-card {
                padding: 1rem 1.5rem;
            }

            .stat-value {
                font-size: 1.75rem;
            }

            /* Show table headers on desktop */
            .table-header {
                display: grid;
                grid-template-columns: 2fr 50px 80px 140px 1.5fr 32px;
                gap: 0.25rem;
                padding: 0.5rem 0.75rem;
                background: #f1f5f9;
                font-weight: 700;
                font-size: 0.7rem;
                text-transform: uppercase;
                color: var(--text-muted);
                border-bottom: 1px solid var(--border-light);
            }

            .table-header.boarding-header {
                display: grid;
                grid-template-columns: 2fr 50px 80px 90px 70px 100px 100px 1.5fr 32px;
            }

            .table-header.grooming-header {
                display: grid;
                grid-template-columns: 2fr 110px 110px 70px 32px;
            }

            .table-header.boarding-school-header {
                display: grid;
                grid-template-columns: 2fr 120px 120px 80px 32px;
            }

            /* Dog rows â€” table layout on desktop */
            .dog-row {
                display: grid;
                grid-template-columns: 2fr 50px 80px 140px 1.5fr 32px;
                gap: 0.25rem;
                padding: 0.4rem 0.75rem;
                margin: 0;
                border-radius: 0;
                border-width: 0;
                border-bottom: 1px solid var(--border-light);
                border-left-width: 4px;
                border-left-style: solid;
                box-shadow: none;
                grid-template-rows: auto;
            }

            .dog-row:last-child {
                border-bottom: none;
            }

            .dog-row .dog-name {
                font-size: 0.95rem;
                font-weight: 700;
                padding: 0.4rem 0;
            }

            /* Hide notes toggle on desktop (notes always visible) */
            .notes-toggle { display: none !important; }

            /* Notes always visible on desktop */
            .dog-row .notes-input {
                opacity: 1;
                min-height: auto;
                padding: 0.4rem;
                margin: 0;
                border-width: 2px;
                border-style: solid;
                border-color: var(--border-light);
                font-size: 0.8rem;
            }

            /* VP group labels hidden on desktop */
            .vp-group-label { display: none !important; }
            .vp-divider { display: none; }

            /* Photo checkbox smaller on desktop */
            .photo-checkbox {
                width: 28px;
                height: 28px;
            }

            .photo-checkbox:checked::after {
                font-size: 1rem;
            }

            .dog-row .photo-check::before { display: none; }

            /* Delete button smaller */
            .delete-btn {
                width: 28px;
                height: 28px;
                font-size: 1.1rem;
            }

            /* Walk select smaller */
            .walk-select {
                font-size: 0.8rem;
                min-height: auto;
                padding: 0.4rem;
            }

            /* VP selects smaller */
            .vp-select {
                width: 36px;
                min-height: auto;
                font-size: 0.75rem;
                padding: 0.35rem 0.1rem;
            }

            /* Stop selects smaller */
            .stop-select {
                width: 36px;
                min-height: auto;
                font-size: 0.75rem;
                padding: 0.3rem 0.1rem;
            }

            /* Desktop boarding row */
            .dog-row.boarding {
                grid-template-columns: 2fr 50px 80px 90px 70px 100px 100px 1.5fr 32px;
                grid-template-rows: auto;
            }

            /* Desktop grooming row */
            .dog-row.grooming {
                grid-template-columns: 2fr 110px 110px 70px 32px;
                grid-template-rows: auto;
            }

            /* Desktop boarding school row */
            .dog-row.boarding-school {
                grid-template-columns: 2fr 120px 120px 80px 32px;
                grid-template-rows: auto;
            }

            /* Multi-column board layout */
            .board-container.cols-2 { grid-template-columns: repeat(2, 1fr); }
            .board-container.cols-3 { grid-template-columns: repeat(3, 1fr); }
            .board-container.cols-4 { grid-template-columns: repeat(4, 1fr); }
        }

        /* Large desktop */
        @media (min-width: 1100px) {
            .board-container.cols-2 { grid-template-columns: repeat(2, 1fr); }
            .board-container.cols-3 { grid-template-columns: repeat(3, 1fr); }
        }

        @media (min-width: 1400px) {
            .board-container.cols-4 { grid-template-columns: repeat(4, 1fr); }
            .board-container.cols-5 { grid-template-columns: repeat(5, 1fr); }
            .board-container.cols-6 { grid-template-columns: repeat(6, 1fr); }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-left">
            <img src="https://i.ibb.co/whdBKp0L/Logo-1.jpg" alt="Fairy Tails" class="logo">
            <div>
                <div class="header-title">Staff Board</div>
                <div class="header-subtitle">Fairy Tails K9 Centre</div>
            </div>
        </div>
        <div class="header-right">
            <div class="current-time" id="currentTime">--:--</div>
            <button class="refresh-btn" onclick="manualRefresh()" title="Refresh from Google Sheets">
                ðŸ”„
            </button>
        </div>
    </header>

    <!-- Tab Navigation (desktop only â€” hidden on mobile via CSS) -->
    <nav class="tab-nav">
        <button class="tab-btn active" data-tab="today" onclick="switchTab('today')">
            ðŸ“… TODAY
        </button>
        <button class="tab-btn" data-tab="tomorrow" onclick="switchTab('tomorrow')">
            ðŸ“† TOMORROW
        </button>
        <div class="tab-actions">
            <button class="btn btn-success" onclick="transferToToday()">
                â¬…ï¸ Transfer â†’ Today
            </button>
            <button class="btn btn-primary" onclick="saveBoard()">
                ðŸ’¾ Save
            </button>
        </div>
    </nav>

    <!-- Today Tab -->
    <div class="tab-content active" id="today-tab">
        <!-- Staging Area â€” Collapsible -->
        <div class="staging-area" id="today-staging-area">
            <div class="staging-header" onclick="toggleStaging('today')">
                <div class="staging-title">
                    ðŸ• Add Dogs
                    <span class="staging-count" id="today-staging-count">0</span>
                </div>
                <div class="staging-chevron">
                    <button class="btn btn-outline btn-small" onclick="event.stopPropagation(); clearStaging('today')">Clear</button>
                    <span class="chevron-icon">â–¼</span>
                </div>
            </div>
            <div class="staging-body">
                <div class="staging-input-row">
                    <input type="text" class="staging-input" id="today-staging-input" 
                           placeholder="Type dog name and press Enter..." 
                           onkeypress="handleStagingKeypress(event, 'today')">
                    <select class="service-type-select" id="today-service-type">
                        <option value="Full Day">â˜€ï¸ Full Day</option>
                        <option value="Half Day AM">ðŸŒ… Half Day</option>
                        <option value="Boarding">ðŸ–ï¸ Boarding Hol</option>
                        <option value="Grooming">âœ‚ï¸ Grooming</option>
                        <option value="Boarding School">ðŸŽ“ Boarding School</option>
                    </select>
                    <button class="btn btn-primary" onclick="addToStaging('today')">+ Add</button>
                </div>
                <div class="staging-dogs" id="today-staging-dogs"></div>
                <div class="staging-actions">
                    <button class="btn btn-success" onclick="addStagedToBoard('today')">
                        âœ… Add to Board
                    </button>
                </div>
            </div>
        </div>

        <!-- Stats Bar -->
        <div class="stats-bar">
            <div class="stat-card">
                <div class="stat-icon dogs">ðŸ•</div>
                <div>
                    <div class="stat-value" id="today-dog-count">0</div>
                    <div class="stat-label">Dogs Today</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon photos">ðŸ“¸</div>
                <div>
                    <div class="stat-value" id="today-photo-count">0</div>
                    <div class="stat-label">Photos Done</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon walks">ðŸš¶</div>
                <div>
                    <div class="stat-value" id="today-walk-count">0</div>
                    <div class="stat-label">Walks Booked</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon vans">ðŸš</div>
                <div>
                    <div class="stat-value" id="today-van-count">0</div>
                    <div class="stat-label">Van Pickups</div>
                </div>
            </div>
        </div>

        <!-- Van Legend â€” Collapsible -->
        <div class="van-legend" id="today-van-legend">
            <div class="van-legend-header" onclick="toggleVanLegend('today')">
                <span>ðŸš Van Times & Legend</span>
                <span class="van-chevron">â–¼</span>
            </div>
            <div class="van-legend-body">
                <div class="van-legend-content">
                    <div class="van-item">
                        <span class="van-badge bv">BV</span>
                        <span>Big Van</span>
                        <select class="van-time-select" id="today-bv-time" onchange="updateVanTime('today', 'BV', this.value)">
                        </select>
                    </div>
                    <div class="van-item">
                        <span class="van-badge dv">DV</span>
                        <span>Dispatch Van</span>
                        <select class="van-time-select" id="today-dv-time" onchange="updateVanTime('today', 'DV', this.value)">
                        </select>
                    </div>
                    <div class="van-item">
                        <span class="van-badge sv">SV</span>
                        <span>Small Van</span>
                        <select class="van-time-select" id="today-sv-time" onchange="updateVanTime('today', 'SV', this.value)">
                        </select>
                    </div>
                    <div class="walk-legend">
                        <span style="color: var(--warning-amber);">WalkðŸ“† = Booked</span>
                        <span style="color: var(--success-green);">Walkâœ… = On Walking Board</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Board -->
        <div class="board-container cols-1" id="today-board">
            <div class="empty-board">
                <div class="empty-board-icon">ðŸ¾</div>
                <div class="empty-board-text">No dogs on the board yet</div>
                <div class="empty-board-hint">Add dogs using the staging area above</div>
            </div>
        </div>
    </div>

    <!-- Tomorrow Tab -->
    <div class="tab-content" id="tomorrow-tab">
        <!-- Staging Area â€” Collapsible -->
        <div class="staging-area" id="tomorrow-staging-area">
            <div class="staging-header" onclick="toggleStaging('tomorrow')">
                <div class="staging-title">
                    ðŸ• Add Dogs
                    <span class="staging-count" id="tomorrow-staging-count">0</span>
                </div>
                <div class="staging-chevron">
                    <button class="btn btn-outline btn-small" onclick="event.stopPropagation(); clearStaging('tomorrow')">Clear</button>
                    <span class="chevron-icon">â–¼</span>
                </div>
            </div>
            <div class="staging-body">
                <div class="staging-input-row">
                    <input type="text" class="staging-input" id="tomorrow-staging-input" 
                           placeholder="Type dog name and press Enter..." 
                           onkeypress="handleStagingKeypress(event, 'tomorrow')">
                    <select class="service-type-select" id="tomorrow-service-type">
                        <option value="Full Day">â˜€ï¸ Full Day</option>
                        <option value="Half Day AM">ðŸŒ… Half Day</option>
                        <option value="Boarding">ðŸ–ï¸ Boarding Hol</option>
                        <option value="Grooming">âœ‚ï¸ Grooming</option>
                        <option value="Boarding School">ðŸŽ“ Boarding School</option>
                    </select>
                    <button class="btn btn-primary" onclick="addToStaging('tomorrow')">+ Add</button>
                </div>
                <div class="staging-dogs" id="tomorrow-staging-dogs"></div>
                <div class="staging-actions">
                    <button class="btn btn-success" onclick="addStagedToBoard('tomorrow')">
                        âœ… Add to Board
                    </button>
                </div>
            </div>
        </div>

        <!-- Stats Bar -->
        <div class="stats-bar">
            <div class="stat-card">
                <div class="stat-icon dogs">ðŸ•</div>
                <div>
                    <div class="stat-value" id="tomorrow-dog-count">0</div>
                    <div class="stat-label">Dogs Tomorrow</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon walks">ðŸš¶</div>
                <div>
                    <div class="stat-value" id="tomorrow-walk-count">0</div>
                    <div class="stat-label">Walks Booked</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon vans">ðŸš</div>
                <div>
                    <div class="stat-value" id="tomorrow-van-count">0</div>
                    <div class="stat-label">Van Pickups</div>
                </div>
            </div>
        </div>

        <!-- Van Legend â€” Collapsible -->
        <div class="van-legend" id="tomorrow-van-legend">
            <div class="van-legend-header" onclick="toggleVanLegend('tomorrow')">
                <span>ðŸš Van Times & Legend</span>
                <span class="van-chevron">â–¼</span>
            </div>
            <div class="van-legend-body">
                <div class="van-legend-content">
                    <div class="van-item">
                        <span class="van-badge bv">BV</span>
                        <span>Big Van</span>
                        <select class="van-time-select" id="tomorrow-bv-time" onchange="updateVanTime('tomorrow', 'BV', this.value)">
                        </select>
                    </div>
                    <div class="van-item">
                        <span class="van-badge dv">DV</span>
                        <span>Dispatch Van</span>
                        <select class="van-time-select" id="tomorrow-dv-time" onchange="updateVanTime('tomorrow', 'DV', this.value)">
                        </select>
                    </div>
                    <div class="van-item">
                        <span class="van-badge sv">SV</span>
                        <span>Small Van</span>
                        <select class="van-time-select" id="tomorrow-sv-time" onchange="updateVanTime('tomorrow', 'SV', this.value)">
                        </select>
                    </div>
                </div>
            </div>
        </div>

        <!-- Board -->
        <div class="board-container cols-1" id="tomorrow-board">
            <div class="empty-board">
                <div class="empty-board-icon">ðŸ¾</div>
                <div class="empty-board-text">No dogs on the board yet</div>
                <div class="empty-board-hint">Add dogs using the staging area above</div>
            </div>
        </div>
    </div>

    <!-- Bottom Navigation (mobile only â€” hidden on tablet/desktop via CSS) -->
    <nav class="bottom-nav">
        <button class="bottom-tab active" data-tab="today" onclick="switchTab('today')">
            <span class="tab-icon">ðŸ“…</span>
            <span>Today</span>
        </button>
        <button class="bottom-tab" data-tab="tomorrow" onclick="switchTab('tomorrow')">
            <span class="tab-icon">ðŸ“†</span>
            <span>Tomorrow</span>
        </button>
        <div class="bottom-nav-actions">
            <button class="bottom-action-btn transfer" onclick="transferToToday()" title="Transfer Tomorrow â†’ Today">
                â¬…ï¸
            </button>
            <button class="bottom-action-btn save" onclick="saveBoard()" title="Save to Cloud">
                ðŸ’¾
            </button>
        </div>
    </nav>

    <!-- Transfer Confirmation Modal -->
    <div class="modal-overlay" id="transferModal">
        <div class="modal">
            <div class="modal-title">âš ï¸ Transfer Tomorrow to Today?</div>
            <div class="modal-text">
                This will replace all of Today's data with Tomorrow's data, and clear Tomorrow's board. This action cannot be undone.
            </div>
            <div class="modal-actions">
                <button class="btn btn-outline" onclick="closeModal()">Cancel</button>
                <button class="btn btn-danger" onclick="confirmTransfer()">Yes, Transfer</button>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <script>
        // =====================
        // Configuration
        // =====================
        const CONFIG = {
            SCRIPT_URL: 'https://script.google.com/macros/s/AKfycbzqXD9OCM5oSNFdy3OF7pOG0PRcpy4dgkEYWJBVh40CFHJgjvSpPn6SE-mNjloo-GKw/exec',
            USE_GOOGLE_SHEETS: true,  // Set to false to use localStorage only
            MAX_ROWS_PER_COLUMN: 15
        };

        // =====================
        // State Management
        // =====================
        let state = {
            today: { 
                dogs: [], 
                staging: [],
                vanTimes: { BV: '07:30', DV: '08:00', SV: '08:30' }
            },
            tomorrow: { 
                dogs: [], 
                staging: [],
                vanTimes: { BV: '07:30', DV: '08:00', SV: '08:30' }
            },
            currentTab: 'today',
            initialLoadComplete: false  // Prevents autoSave until data is loaded
        };

        // =====================
        // Mobile UI: Collapsible Staging & Van Legend
        // =====================
        function toggleStaging(tab) {
            const el = document.getElementById(`${tab}-staging-area`);
            el.classList.toggle('expanded');
        }

        function toggleVanLegend(tab) {
            const el = document.getElementById(`${tab}-van-legend`);
            el.classList.toggle('expanded');
        }

        // =====================
        // Time Options Generator
        // =====================
        function generateTimeOptions() {
            const options = [];
            for (let hour = 0; hour < 24; hour++) {
                for (let minute = 0; minute < 60; minute += 15) {
                    const h = hour.toString().padStart(2, '0');
                    const m = minute.toString().padStart(2, '0');
                    options.push(`${h}:${m}`);
                }
            }
            return options;
        }

        function populateVanTimeDropdowns() {
            const timeOptions = generateTimeOptions();
            const optionsHTML = timeOptions.map(t => `<option value="${t}">${t}</option>`).join('');
            
            // Populate all van time selects
            ['today', 'tomorrow'].forEach(tab => {
                ['bv', 'dv', 'sv'].forEach(van => {
                    const select = document.getElementById(`${tab}-${van}-time`);
                    if (select) {
                        select.innerHTML = optionsHTML;
                        select.value = state[tab].vanTimes[van.toUpperCase()] || '08:00';
                    }
                });
            });
        }

        function updateVanTime(tab, van, time) {
            state[tab].vanTimes[van] = time;
            autoSave();
        }

        // =====================
        // Utility Functions
        // =====================
        function generateId() {
            return 'dog_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        }

        // Returns abbreviated day name (Mon, Tue, etc.) from a YYYY-MM-DD date string
        function getDayName(dateStr) {
            if (!dateStr) return '';
            const date = new Date(dateStr + 'T00:00:00');
            if (isNaN(date.getTime())) return '';
            return date.toLocaleDateString('en-GB', { weekday: 'short' });
        }

        // Updates the day-of-week label next to a date input
        function updateDayLabel(inputEl) {
            const label = inputEl.parentElement.querySelector('.day-label');
            if (label) {
                const day = getDayName(inputEl.value);
                label.textContent = day;
                label.classList.toggle('visible', !!day);
            }
        }

        function showToast(message, type = 'info') {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerHTML = `<span>${message}</span>`;
            container.appendChild(toast);
            setTimeout(() => toast.remove(), 3000);
        }

        function updateTime() {
            const now = new Date();
            document.getElementById('currentTime').textContent = 
                now.toLocaleTimeString('en-GB', { hour: '2-digit', minute: '2-digit' });
        }

        // =====================
        // Tab Management (handles both bottom nav and desktop tabs)
        // =====================
        function switchTab(tab) {
            state.currentTab = tab;
            
            // Update desktop tab buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.tab === tab);
            });
            
            // Update bottom nav tab buttons
            document.querySelectorAll('.bottom-tab').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.tab === tab);
            });
            
            // Switch content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(`${tab}-tab`).classList.add('active');
        }

        // =====================
        // Staging Area
        // =====================
        function handleStagingKeypress(event, tab) {
            if (event.key === 'Enter') {
                addToStaging(tab);
            }
        }

        function addToStaging(tab) {
            const input = document.getElementById(`${tab}-staging-input`);
            const name = input.value.trim();
            
            if (!name) return;
            
            state[tab].staging.push(name);
            input.value = '';
            input.focus();
            
            renderStaging(tab);
        }

        function removeFromStaging(tab, index) {
            state[tab].staging.splice(index, 1);
            renderStaging(tab);
        }

        function clearStaging(tab) {
            state[tab].staging = [];
            renderStaging(tab);
        }

        function renderStaging(tab) {
            const container = document.getElementById(`${tab}-staging-dogs`);
            const countEl = document.getElementById(`${tab}-staging-count`);
            const staging = state[tab].staging;
            
            countEl.textContent = staging.length;
            
            if (staging.length === 0) {
                container.innerHTML = '';
                return;
            }
            
            container.innerHTML = staging.map((name, index) => `
                <div class="staged-dog">
                    <span>${name}</span>
                    <button class="staged-dog-remove" onclick="removeFromStaging('${tab}', ${index})">Ã—</button>
                </div>
            `).join('');
        }

        function addStagedToBoard(tab) {
            const staging = state[tab].staging;
            
            if (staging.length === 0) {
                showToast('No dogs to add â€” enter some names first', 'error');
                return;
            }
            
            // Get selected service type
            const serviceTypeSelect = document.getElementById(`${tab}-service-type`);
            const serviceType = serviceTypeSelect ? serviceTypeSelect.value : 'Full Day';
            
            // Create dog objects from staged names with selected service type
            const newDogs = staging.map(name => {
                // Base dog object with all fields
                const dog = {
                    id: generateId(),
                    name: name,
                    photo: false,
                    walk: '',
                    vpAM: '',
                    vpPM: '',
                    stopAM: '',
                    stop: '',
                    notes: '',
                    crate: '',
                    serviceType: serviceType,
                    // Grooming Dogs fields
                    pickup: '',
                    dropoff: '',
                    vanType: '',
                    // Boarding School fields
                    checkIn: '',
                    checkOut: '',
                    crateSize: ''
                };
                return dog;
            });
            
            // Add to existing dogs
            state[tab].dogs = [...state[tab].dogs, ...newDogs];
            
            // Clear staging
            state[tab].staging = [];
            renderStaging(tab);
            
            // Re-render board
            renderBoard(tab);
            
            // Auto-save
            autoSave();
            
            showToast(`âœ… Added ${newDogs.length} dog${newDogs.length > 1 ? 's' : ''} to ${serviceType}`, 'success');
        }

        // =====================
        // Layout Algorithm
        // =====================
        function calculateLayout(dogCount) {
            if (dogCount === 0) return { columns: 1, rowsPerColumn: 0, scale: '' };
            
            // Comfortable editing layout with scrolling allowed
            if (dogCount <= 12) {
                return { columns: 1, rowsPerColumn: dogCount, scale: '' };
            }
            if (dogCount <= 24) {
                return { columns: 2, rowsPerColumn: Math.ceil(dogCount / 2), scale: '' };
            }
            if (dogCount <= 45) {
                return { columns: 3, rowsPerColumn: Math.ceil(dogCount / 3), scale: '' };
            }
            
            // For larger numbers, use 4 columns
            return { columns: 4, rowsPerColumn: Math.ceil(dogCount / 4), scale: '' };
        }

        // Recalculate layout on window resize
        let resizeTimeout;
        window.addEventListener('resize', () => {
            clearTimeout(resizeTimeout);
            resizeTimeout = setTimeout(() => {
                renderBoard('today');
                renderBoard('tomorrow');
            }, 250);
        });

        // =====================
        // Board Rendering
        // =====================
        function createDogRow(dog, sectionClass = '') {
            const { id, name, photo, walk, vpAM, vpPM, stopAM, stop, notes } = dog;
            
            // Determine styling classes for VP selects
            const getVPClass = (val) => {
                if (val === 'V' || val === 'BV') return 'van-bv';
                if (val === 'SV') return 'van-sv';
                if (val === 'DV') return 'van-dv';
                if (val === 'P') return 'parent-pickup';
                return '';
            };
            
            const vpAMClass = getVPClass(vpAM);
            const vpPMClass = getVPClass(vpPM);
            
            // Disable stop selects based on van/parent selection
            const vanOptions = ['V', 'BV', 'SV', 'DV'];
            const stopAMDisabled = !vanOptions.includes(vpAM);
            const stopPMDisabled = !vanOptions.includes(vpPM);
            
            // Generate stop number options (1-20)
            const generateStopOptions = (selectedValue) => {
                let options = '<option value="">-</option>';
                for (let i = 1; i <= 20; i++) {
                    const selected = String(selectedValue) === String(i) ? 'selected' : '';
                    options += `<option value="${i}" ${selected}>${i}</option>`;
                }
                return options;
            };

            return `
                <div class="dog-row section-row ${sectionClass} ${notes ? 'notes-expanded' : ''}" data-id="${id}">
                    <div class="dog-name">${name}</div>
                    
                    <div class="photo-check">
                        <input type="checkbox" class="photo-checkbox" 
                               ${photo ? 'checked' : ''} 
                               onchange="updateDog('${id}', 'photo', this.checked)">
                    </div>
                    
                    <select class="walk-select ${walk === 'booked' ? 'walk-booked' : walk === 'transferred' ? 'walk-transferred' : ''}" 
                            onchange="updateDog('${id}', 'walk', this.value); updateWalkStyle(this)">
                        <option value="">None</option>
                        <option value="booked" ${walk === 'booked' ? 'selected' : ''}>WalkðŸ“†</option>
                        <option value="transferred" ${walk === 'transferred' ? 'selected' : ''}>Walkâœ…</option>
                    </select>
                    
                    <div class="vp-control">
                        <select class="stop-select stop-am ${stopAM ? 'has-value' : ''}" 
                               ${stopAMDisabled ? 'disabled' : ''}
                               onchange="updateDog('${id}', 'stopAM', this.value); updateStopStyle(this)"
                               title="AM Stop Number">
                            ${generateStopOptions(stopAM)}
                        </select>
                        <span class="vp-group-label">AM</span>
                        <select class="vp-select vp-am ${vpAMClass}" 
                                onchange="updateDog('${id}', 'vpAM', this.value); updateVPStyle(this)"
                                title="Morning pickup">
                            <option value="">-</option>
                            <option value="V" ${vpAM === 'V' ? 'selected' : ''}>V</option>
                            <option value="P" ${vpAM === 'P' ? 'selected' : ''}>P</option>
                            <option value="BV" ${vpAM === 'BV' ? 'selected' : ''}>BV</option>
                            <option value="SV" ${vpAM === 'SV' ? 'selected' : ''}>SV</option>
                            <option value="DV" ${vpAM === 'DV' ? 'selected' : ''}>DV</option>
                        </select>
                        <div class="vp-divider"></div>
                        <span class="vp-group-label">PM</span>
                        <select class="vp-select vp-pm ${vpPMClass}" 
                                onchange="updateDog('${id}', 'vpPM', this.value); updateVPStyle(this)"
                                title="Evening dropoff">
                            <option value="">-</option>
                            <option value="V" ${vpPM === 'V' ? 'selected' : ''}>V</option>
                            <option value="P" ${vpPM === 'P' ? 'selected' : ''}>P</option>
                            <option value="BV" ${vpPM === 'BV' ? 'selected' : ''}>BV</option>
                            <option value="SV" ${vpPM === 'SV' ? 'selected' : ''}>SV</option>
                            <option value="DV" ${vpPM === 'DV' ? 'selected' : ''}>DV</option>
                        </select>
                        <select class="stop-select stop-pm ${stop ? 'has-value' : ''}" 
                               ${stopPMDisabled ? 'disabled' : ''}
                               onchange="updateDog('${id}', 'stop', this.value); updateStopStyle(this)"
                               title="PM Stop Number">
                            ${generateStopOptions(stop)}
                        </select>
                    </div>
                    
                    <div class="notes-toggle ${notes ? 'has-notes' : ''}" onclick="toggleNotes(this)" title="Toggle notes">
                        <span class="notes-toggle-label">ðŸ“</span>
                        <div class="toggle-track"><div class="toggle-knob"></div></div>
                    </div>
                    
                    <input type="text" class="notes-input" placeholder="Notes..." 
                           value="${notes || ''}" 
                           onchange="updateDog('${id}', 'notes', this.value); updateNotesToggle(this)"
                           oninput="updateNotesToggle(this)">
                    
                    <button class="delete-btn" onclick="deleteDog('${id}')" title="Remove dog">Ã—</button>
                </div>
            `;
        }

        // Boarding-specific row: AM only + Crate select
        function createBoardingDogRow(dog) {
            const { id, name, photo, walk, vpAM, stopAM, notes, crate, checkIn, checkOut } = dog;
            
            const getVPClass = (val) => {
                if (val === 'V' || val === 'BV') return 'van-bv';
                if (val === 'SV') return 'van-sv';
                if (val === 'DV') return 'van-dv';
                if (val === 'P') return 'parent-pickup';
                return '';
            };
            
            const vpAMClass = getVPClass(vpAM);
            const vanOptions = ['V', 'BV', 'SV', 'DV'];
            const stopAMDisabled = !vanOptions.includes(vpAM);
            
            const generateStopOptions = (selectedValue) => {
                let options = '<option value="">-</option>';
                for (let i = 1; i <= 20; i++) {
                    const selected = String(selectedValue) === String(i) ? 'selected' : '';
                    options += `<option value="${i}" ${selected}>${i}</option>`;
                }
                return options;
            };
            
            const crateOptions = ['HLL', 'HLM', 'HLS', 'HSB', 'HST'];

            return `
                <div class="dog-row section-row boarding ${notes ? 'notes-expanded' : ''}" data-id="${id}">
                    <div class="dog-name">${name}</div>
                    
                    <div class="photo-check">
                        <input type="checkbox" class="photo-checkbox" 
                               ${photo ? 'checked' : ''} 
                               onchange="updateDog('${id}', 'photo', this.checked)">
                    </div>
                    
                    <select class="walk-select ${walk === 'booked' ? 'walk-booked' : walk === 'transferred' ? 'walk-transferred' : ''}" 
                            onchange="updateDog('${id}', 'walk', this.value); updateWalkStyle(this)">
                        <option value="">None</option>
                        <option value="booked" ${walk === 'booked' ? 'selected' : ''}>WalkðŸ“†</option>
                        <option value="transferred" ${walk === 'transferred' ? 'selected' : ''}>Walkâœ…</option>
                    </select>
                    
                    <div class="vp-control-am">
                        <select class="stop-select stop-am ${stopAM ? 'has-value' : ''}" 
                               ${stopAMDisabled ? 'disabled' : ''}
                               onchange="updateDog('${id}', 'stopAM', this.value); updateStopStyle(this)"
                               title="AM Stop Number">
                            ${generateStopOptions(stopAM)}
                        </select>
                        <select class="vp-select vp-am ${vpAMClass}" 
                                onchange="updateDog('${id}', 'vpAM', this.value); updateVPStyle(this)"
                                title="AM pickup">
                            <option value="">-</option>
                            <option value="V" ${vpAM === 'V' ? 'selected' : ''}>V</option>
                            <option value="P" ${vpAM === 'P' ? 'selected' : ''}>P</option>
                            <option value="BV" ${vpAM === 'BV' ? 'selected' : ''}>BV</option>
                            <option value="SV" ${vpAM === 'SV' ? 'selected' : ''}>SV</option>
                            <option value="DV" ${vpAM === 'DV' ? 'selected' : ''}>DV</option>
                        </select>
                    </div>
                    
                    <select class="crate-select ${crate ? 'has-value' : ''}" 
                            onchange="updateDog('${id}', 'crate', this.value); this.classList.toggle('has-value', !!this.value)"
                            title="Crate type">
                        <option value="">-</option>
                        ${crateOptions.map(c => `<option value="${c}" ${crate === c ? 'selected' : ''}>${c}</option>`).join('')}
                    </select>
                    
                    <div class="date-with-day boarding-checkin">
                        <input type="date" class="boarding-date-input ${checkIn ? 'has-value' : ''}" 
                               value="${checkIn || ''}"
                               onchange="updateDog('${id}', 'checkIn', this.value); this.classList.toggle('has-value', !!this.value); updateDayLabel(this)"
                               title="Check In Date">
                        <span class="day-label ${checkIn ? 'visible' : ''}">${getDayName(checkIn)}</span>
                    </div>
                    
                    <div class="date-with-day boarding-checkout">
                        <input type="date" class="boarding-date-input ${checkOut ? 'has-value' : ''}" 
                               value="${checkOut || ''}"
                               onchange="updateDog('${id}', 'checkOut', this.value); this.classList.toggle('has-value', !!this.value); updateDayLabel(this)"
                               title="Check Out Date">
                        <span class="day-label ${checkOut ? 'visible' : ''}">${getDayName(checkOut)}</span>
                    </div>
                    
                    <div class="notes-toggle ${notes ? 'has-notes' : ''}" onclick="toggleNotes(this)" title="Toggle notes">
                        <span class="notes-toggle-label">ðŸ“</span>
                        <div class="toggle-track"><div class="toggle-knob"></div></div>
                    </div>
                    
                    <input type="text" class="notes-input" placeholder="Notes..." 
                           value="${notes || ''}" 
                           onchange="updateDog('${id}', 'notes', this.value); updateNotesToggle(this)"
                           oninput="updateNotesToggle(this)">
                    
                    <button class="delete-btn" onclick="deleteDog('${id}')" title="Remove dog">Ã—</button>
                </div>
            `;
        }

        // Grooming Dogs row: Name | Pick Up | Drop Off | Van Type | Delete
        function createGroomingDogRow(dog) {
            const { id, name, pickup, dropoff, vanType } = dog;

            const pickupOptions = ['AM Pick Up', 'AM Drop Off', 'PM Pick Up', 'PM Drop Off'];
            const dropoffOptions = ['AM Pick Up', 'AM Drop Off', 'PM Pick Up', 'PM Drop Off'];
            const vanTypeOptions = ['BV', 'SV', 'DV'];

            return `
                <div class="dog-row section-row grooming" data-id="${id}">
                    <div class="dog-name">${name}</div>
                    
                    <select class="grooming-select grooming-pickup ${pickup ? 'has-value' : ''}" 
                            onchange="updateDog('${id}', 'pickup', this.value); this.classList.toggle('has-value', !!this.value)"
                            title="Pick Up">
                        <option value="">Pick Up...</option>
                        ${pickupOptions.map(opt => `<option value="${opt}" ${pickup === opt ? 'selected' : ''}>${opt}</option>`).join('')}
                    </select>
                    
                    <select class="grooming-select grooming-dropoff ${dropoff ? 'has-value' : ''}" 
                            onchange="updateDog('${id}', 'dropoff', this.value); this.classList.toggle('has-value', !!this.value)"
                            title="Drop Off">
                        <option value="">Drop Off...</option>
                        ${dropoffOptions.map(opt => `<option value="${opt}" ${dropoff === opt ? 'selected' : ''}>${opt}</option>`).join('')}
                    </select>
                    
                    <select class="grooming-van-select ${vanType ? 'has-value' : ''}" 
                            onchange="updateDog('${id}', 'vanType', this.value); this.classList.toggle('has-value', !!this.value)"
                            title="Van Type">
                        <option value="">Van...</option>
                        ${vanTypeOptions.map(opt => `<option value="${opt}" ${vanType === opt ? 'selected' : ''}>${opt}</option>`).join('')}
                    </select>
                    
                    <button class="delete-btn" onclick="deleteDog('${id}')" title="Remove dog">Ã—</button>
                </div>
            `;
        }

        // Boarding School row: Name | Check In | Check Out | Crate Size | Delete
        function createBoardingSchoolDogRow(dog) {
            const { id, name, checkIn, checkOut, crateSize } = dog;

            const crateSizeOptions = ['HLL', 'HLM', 'HLS', 'HSB', 'HST'];

            return `
                <div class="dog-row section-row boarding-school" data-id="${id}">
                    <div class="dog-name">${name}</div>
                    
                    <div class="date-with-day bs-checkin">
                        <input type="date" class="bs-date-input ${checkIn ? 'has-value' : ''}" 
                               value="${checkIn || ''}"
                               onchange="updateDog('${id}', 'checkIn', this.value); this.classList.toggle('has-value', !!this.value); updateDayLabel(this)"
                               title="Check In Date">
                        <span class="day-label ${checkIn ? 'visible' : ''}">${getDayName(checkIn)}</span>
                    </div>
                    
                    <div class="date-with-day bs-checkout">
                        <input type="date" class="bs-date-input ${checkOut ? 'has-value' : ''}" 
                               value="${checkOut || ''}"
                               onchange="updateDog('${id}', 'checkOut', this.value); this.classList.toggle('has-value', !!this.value); updateDayLabel(this)"
                               title="Check Out Date">
                        <span class="day-label ${checkOut ? 'visible' : ''}">${getDayName(checkOut)}</span>
                    </div>
                    
                    <select class="bs-crate-select ${crateSize ? 'has-value' : ''}" 
                            onchange="updateDog('${id}', 'crateSize', this.value); this.classList.toggle('has-value', !!this.value)"
                            title="Crate Size">
                        <option value="">Crate...</option>
                        ${crateSizeOptions.map(opt => `<option value="${opt}" ${crateSize === opt ? 'selected' : ''}>${opt}</option>`).join('')}
                    </select>
                    
                    <button class="delete-btn" onclick="deleteDog('${id}')" title="Remove dog">Ã—</button>
                </div>
            `;
        }

        function renderBoard(tab) {
            const board = document.getElementById(`${tab}-board`);
            const dogs = state[tab].dogs;
            
            // Empty state
            if (dogs.length === 0) {
                board.className = 'board-container cols-1';
                board.innerHTML = `
                    <div class="empty-board">
                        <div class="empty-board-icon">ðŸ¾</div>
                        <div class="empty-board-text">No dogs on the board yet</div>
                        <div class="empty-board-hint">Add dogs using the staging area above</div>
                    </div>
                `;
                updateStats(tab);
                return;
            }
            
            // Group dogs by service type
            const serviceGroups = {
                'Half Day AM': [],
                'Full Day': [],
                'Boarding': [],
                'Grooming': [],
                'Boarding School': []
            };
            
            dogs.forEach(dog => {
                const type = dog.serviceType || 'Full Day';
                if (type === 'Grooming') {
                    serviceGroups['Grooming'].push(dog);
                } else if (type === 'Boarding School') {
                    serviceGroups['Boarding School'].push(dog);
                } else if (type.includes('Half Day')) {
                    serviceGroups['Half Day AM'].push(dog);
                } else if (type.includes('Boarding')) {
                    serviceGroups['Boarding'].push(dog);
                } else {
                    serviceGroups['Full Day'].push(dog);
                }
            });
            
            // Service type configuration
            const serviceConfig = {
                'Half Day AM': { 
                    icon: 'ðŸŒ…', 
                    label: 'Half Day (Leave ~12pm)', 
                    class: 'half-day-am',
                    order: 1
                },
                'Full Day': { 
                    icon: 'â˜€ï¸', 
                    label: 'Full Day (Leave ~5pm)', 
                    class: 'full-day',
                    order: 2
                },
                'Boarding': { 
                    icon: 'ðŸ–ï¸', 
                    label: 'Boarding Hol', 
                    class: 'boarding',
                    order: 3
                },
                'Boarding School': { 
                    icon: 'ðŸŽ“', 
                    label: 'Boarding School', 
                    class: 'boarding-school',
                    order: 4
                },
                'Grooming': { 
                    icon: 'âœ‚ï¸', 
                    label: 'Grooming Dogs', 
                    class: 'grooming',
                    order: 5
                }
            };
            
            // Calculate layout
            const layout = calculateLayout(dogs.length);
            
            // Apply column count and scale classes
            let classNames = `board-container cols-1`; // Sections are full width
            if (layout.scale) {
                classNames += ` ${layout.scale}`;
            }
            board.className = classNames;
            
            // Build HTML for each section
            let html = '';
            
            // Pre-build the combined Boarding Parent HTML for correct insertion order
            const boardingHolDogs = serviceGroups['Boarding'];
            const boardingSchoolDogs = serviceGroups['Boarding School'];
            const totalBoardingDogs = boardingHolDogs.length + boardingSchoolDogs.length;
            let boardingParentHtml = '';
            
            if (totalBoardingDogs > 0) {
                // Count crates across both Boarding Hol (field: crate) and Boarding School (field: crateSize)
                const crateLabels = {
                    'HLL': 'Large',
                    'HLM': 'Medium',
                    'HLS': 'Small',
                    'HSB': 'House Bottom',
                    'HST': 'House Small'
                };
                const crateCounts = {};
                boardingHolDogs.forEach(d => { if (d.crate && crateLabels[d.crate]) crateCounts[d.crate] = (crateCounts[d.crate] || 0) + 1; });
                boardingSchoolDogs.forEach(d => { if (d.crateSize && crateLabels[d.crateSize]) crateCounts[d.crateSize] = (crateCounts[d.crateSize] || 0) + 1; });
                
                const crateSummary = ['HLL', 'HLM', 'HLS', 'HSB', 'HST']
                    .filter(code => crateCounts[code])
                    .map(code => `${crateLabels[code]} ${crateCounts[code]}`)
                    .join(', ');
                const crateSummaryHtml = crateSummary
                    ? `<span class="crate-summary">${crateSummary}</span>`
                    : '';
                
                boardingParentHtml += `
                    <div class="service-section boarding-parent-section">
                        <div class="section-header boarding-parent">
                            <span><span class="section-icon">ðŸ </span>Boarding</span>
                            <div class="boarding-header-stats">
                                ${crateSummaryHtml}
                                <span class="section-count">${totalBoardingDogs} dog${totalBoardingDogs !== 1 ? 's' : ''}</span>
                            </div>
                        </div>
                        <div class="boarding-subsections">
                `;
                
                if (boardingHolDogs.length > 0) {
                    const bhConfig = serviceConfig['Boarding'];
                    const bhRowsHtml = boardingHolDogs.map(dog => createBoardingDogRow(dog)).join('');
                    boardingParentHtml += `
                            <div class="boarding-sub-section">
                                <div class="boarding-sub-header boarding-hol-sub">
                                    <span><span class="section-icon">${bhConfig.icon}</span>${bhConfig.label}</span>
                                    <span class="section-count">${boardingHolDogs.length} dog${boardingHolDogs.length !== 1 ? 's' : ''}</span>
                                </div>
                                <div class="section-content">
                                    <div class="table-header boarding-header">
                                        <span>Name</span><span>Photo</span><span>Walk</span><span>AM</span><span>Crate</span><span>Check In</span><span>Check Out</span><span>Notes</span><span></span>
                                    </div>
                                    <div class="dog-rows">
                                        ${bhRowsHtml}
                                    </div>
                                </div>
                            </div>
                    `;
                }
                
                if (boardingSchoolDogs.length > 0) {
                    const bsConfig = serviceConfig['Boarding School'];
                    const bsRowsHtml = boardingSchoolDogs.map(dog => createBoardingSchoolDogRow(dog)).join('');
                    boardingParentHtml += `
                            <div class="boarding-sub-section">
                                <div class="boarding-sub-header boarding-school-sub">
                                    <span><span class="section-icon">${bsConfig.icon}</span>${bsConfig.label}</span>
                                    <span class="section-count">${boardingSchoolDogs.length} dog${boardingSchoolDogs.length !== 1 ? 's' : ''}</span>
                                </div>
                                <div class="section-content">
                                    <div class="table-header boarding-school-header">
                                        <span>Name</span><span>Check In</span><span>Check Out</span><span>Crate Size</span><span></span>
                                    </div>
                                    <div class="dog-rows">
                                        ${bsRowsHtml}
                                    </div>
                                </div>
                            </div>
                    `;
                }
                
                boardingParentHtml += `
                        </div>
                    </div>
                `;
            }
            
            // Render sections in order
            const orderedTypes = Object.keys(serviceGroups).sort((a, b) => 
                serviceConfig[a].order - serviceConfig[b].order
            );
            
            for (const serviceType of orderedTypes) {
                const sectionDogs = serviceGroups[serviceType];
                
                if (serviceType === 'Boarding') {
                    html += boardingParentHtml;
                    continue;
                }
                
                if (serviceType === 'Boarding School') continue;
                
                if (sectionDogs.length === 0) continue;
                
                const config = serviceConfig[serviceType];
                const isGrooming = serviceType === 'Grooming';
                
                let tableHeaderClass, headerCols, rowsHtml;
                
                if (isGrooming) {
                    tableHeaderClass = 'table-header grooming-header';
                    headerCols = `<span>Name</span><span>Pick Up</span><span>Drop Off</span><span>Van Type</span><span></span>`;
                    rowsHtml = sectionDogs.map(dog => createGroomingDogRow(dog)).join('');
                } else {
                    tableHeaderClass = 'table-header';
                    headerCols = `<span>Name</span><span>Photo</span><span>Walk</span><span>AM/PM</span><span>Notes</span><span></span>`;
                    rowsHtml = sectionDogs.map(dog => createDogRow(dog, config.class)).join('');
                }
                
                html += `
                    <div class="service-section">
                        <div class="section-header ${config.class}">
                            <span><span class="section-icon">${config.icon}</span>${config.label}</span>
                            <span class="section-count">${sectionDogs.length} dog${sectionDogs.length !== 1 ? 's' : ''}</span>
                        </div>
                        <div class="section-content">
                            <div class="${tableHeaderClass}">
                                ${headerCols}
                            </div>
                            <div class="dog-rows">
                                ${rowsHtml}
                            </div>
                        </div>
                    </div>
                `;
            }

            board.innerHTML = html;
            updateStats(tab);
        }

        function updateStats(tab) {
            const dogs = state[tab].dogs;
            
            document.getElementById(`${tab}-dog-count`).textContent = dogs.length;
            
            if (tab === 'today') {
                document.getElementById(`${tab}-photo-count`).textContent = 
                    dogs.filter(d => d.photo).length;
            }
            
            document.getElementById(`${tab}-walk-count`).textContent = 
                dogs.filter(d => d.walk).length;
            
            // Count dogs with any van option (V, BV, SV, or DV) in AM or PM
            const vanOptions = ['V', 'BV', 'SV', 'DV'];
            document.getElementById(`${tab}-van-count`).textContent = 
                dogs.filter(d => vanOptions.includes(d.vpAM) || vanOptions.includes(d.vpPM)).length;
        }

        // =====================
        // Dog Management
        // =====================
        function updateDog(id, field, value) {
            const tab = state.currentTab;
            const dog = state[tab].dogs.find(d => d.id === id);
            if (dog) {
                dog[field] = value;
                updateStats(tab);
                autoSave(); // Save changes immediately
            }
        }

        // Toggle notes row visibility on mobile
        function toggleNotes(toggleEl) {
            const row = toggleEl.closest('.dog-row');
            row.classList.toggle('notes-expanded');
            
            // If expanding, focus the input for immediate typing
            if (row.classList.contains('notes-expanded')) {
                const input = row.querySelector('.notes-input');
                setTimeout(() => input.focus(), 280);
            }
        }
        
        // Sync the has-notes indicator when notes content changes
        function updateNotesToggle(input) {
            const row = input.closest('.dog-row');
            const toggle = row.querySelector('.notes-toggle');
            if (toggle) {
                if (input.value.trim()) {
                    toggle.classList.add('has-notes');
                } else {
                    toggle.classList.remove('has-notes');
                }
            }
        }

        function updateWalkStyle(select) {
            select.classList.remove('walk-booked', 'walk-transferred');
            if (select.value === 'booked') select.classList.add('walk-booked');
            if (select.value === 'transferred') select.classList.add('walk-transferred');
        }

        function updateVPStyle(select) {
            const row = select.closest('.dog-row');
            const stopAMSelect = row.querySelector('.stop-am');
            const stopPMSelect = row.querySelector('.stop-pm');
            const vpAMSelect = row.querySelector('.vp-am');
            const vpPMSelect = row.querySelector('.vp-pm');
            
            // Update class for styling
            select.classList.remove('van-pickup', 'van-bv', 'van-sv', 'van-dv', 'parent-pickup');
            if (select.value === 'V' || select.value === 'BV') select.classList.add('van-bv');
            if (select.value === 'SV') select.classList.add('van-sv');
            if (select.value === 'DV') select.classList.add('van-dv');
            if (select.value === 'P') select.classList.add('parent-pickup');
            
            const vanOptions = ['V', 'BV', 'SV', 'DV'];
            
            if (vpAMSelect && stopAMSelect) {
                const isAMVan = vanOptions.includes(vpAMSelect.value);
                stopAMSelect.disabled = !isAMVan;
                if (!isAMVan) {
                    stopAMSelect.value = '';
                    stopAMSelect.classList.remove('has-value');
                    const id = row.dataset.id;
                    updateDog(id, 'stopAM', '');
                }
            }
            
            if (vpPMSelect && stopPMSelect) {
                const isPMVan = vanOptions.includes(vpPMSelect.value);
                stopPMSelect.disabled = !isPMVan;
                if (!isPMVan) {
                    stopPMSelect.value = '';
                    stopPMSelect.classList.remove('has-value');
                    const id = row.dataset.id;
                    updateDog(id, 'stop', '');
                }
            }
        }

        function updateStopStyle(select) {
            if (select.value) {
                select.classList.add('has-value');
            } else {
                select.classList.remove('has-value');
            }
        }

        function deleteDog(id) {
            const tab = state.currentTab;
            const dog = state[tab].dogs.find(d => d.id === id);
            const dogName = dog ? dog.name : 'Dog';
            
            state[tab].dogs = state[tab].dogs.filter(d => d.id !== id);
            renderBoard(tab);
            autoSave();
            showToast(`ðŸ—‘ï¸ ${dogName} removed from board`, 'info');
        }

        // =====================
        // Transfer & Clear
        // =====================
        function transferToToday() {
            if (state.tomorrow.dogs.length === 0) {
                showToast('Tomorrow\'s board is empty â€” nothing to transfer', 'error');
                return;
            }
            document.getElementById('transferModal').classList.add('active');
        }

        async function confirmTransfer() {
            if (CONFIG.USE_GOOGLE_SHEETS && CONFIG.SCRIPT_URL) {
                try {
                    const response = await fetch(CONFIG.SCRIPT_URL, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ action: 'transfer' })
                    });
                    
                    const result = await response.json();
                    
                    if (result.success) {
                        await loadBoard();
                        closeModal();
                        showToast(`âœ… Transferred ${result.transferred} dogs to Today!`, 'success');
                        switchTab('today');
                        return;
                    }
                } catch (error) {
                    console.error('Failed to transfer via Google Sheets:', error);
                }
            }
            
            // Local transfer fallback
            state.today.dogs = JSON.parse(JSON.stringify(state.tomorrow.dogs));
            state.today.vanTimes = JSON.parse(JSON.stringify(state.tomorrow.vanTimes));
            
            state.today.dogs.forEach(dog => {
                dog.photo = false;
                dog.notes = '';
                if (dog.walk === 'transferred') {
                    dog.walk = 'booked';
                }
            });
            
            state.tomorrow.dogs = [];
            state.tomorrow.staging = [];
            state.tomorrow.vanTimes = { BV: '07:30', DV: '08:00', SV: '08:30' };
            
            populateVanTimeDropdowns();
            renderBoard('today');
            renderBoard('tomorrow');
            renderStaging('tomorrow');
            
            closeModal();
            showToast('âœ… Tomorrow transferred to Today successfully!', 'success');
            switchTab('today');
            saveBoard();
        }

        function closeModal() {
            document.querySelectorAll('.modal-overlay').forEach(m => m.classList.remove('active'));
        }

        // =====================
        // Background Data Sync
        // =====================

        async function manualRefresh() {
            const btn = document.querySelector('.refresh-btn');
            btn.classList.add('refreshing');
            
            try {
                if (CONFIG.USE_GOOGLE_SHEETS && CONFIG.SCRIPT_URL) {
                    const response = await fetch(`${CONFIG.SCRIPT_URL}?action=load`);
                    const result = await response.json();
                    
                    if (result.success && result.data) {
                        const oldTodayCount = state.today.dogs.length;
                        const oldTomorrowCount = state.tomorrow.dogs.length;
                        
                        state.today.dogs = result.data.today?.dogs || [];
                        state.today.staging = result.data.today?.staging || [];
                        state.today.vanTimes = result.data.today?.vanTimes || { BV: '07:30', DV: '08:00', SV: '08:30' };
                        state.tomorrow.dogs = result.data.tomorrow?.dogs || [];
                        state.tomorrow.staging = result.data.tomorrow?.staging || [];
                        state.tomorrow.vanTimes = result.data.tomorrow?.vanTimes || { BV: '07:30', DV: '08:00', SV: '08:30' };
                        
                        populateVanTimeDropdowns();
                        renderStaging('today');
                        renderStaging('tomorrow');
                        renderBoard('today');
                        renderBoard('tomorrow');
                        
                        const newTodayCount = state.today.dogs.length;
                        const newTomorrowCount = state.tomorrow.dogs.length;
                        
                        showToast(`â˜ï¸ Refreshed from cloud (Today: ${newTodayCount}, Tomorrow: ${newTomorrowCount})`, 'success');
                    } else {
                        showToast('âš ï¸ No data received from cloud', 'error');
                    }
                } else {
                    showToast('âš ï¸ Google Sheets not configured', 'error');
                }
            } catch (error) {
                console.error('Manual refresh failed:', error);
                showToast('âŒ Failed to refresh from cloud', 'error');
            } finally {
                btn.classList.remove('refreshing');
            }
        }

        async function loadBoardSilent() {
            let data = null;
            
            if (CONFIG.USE_GOOGLE_SHEETS && CONFIG.SCRIPT_URL) {
                try {
                    const response = await fetch(`${CONFIG.SCRIPT_URL}?action=load`);
                    const result = await response.json();
                    
                    if (result.success && result.data) {
                        data = result.data;
                    }
                } catch (error) {
                    console.error('Failed to refresh from Google Sheets:', error);
                }
            }
            
            if (!data) {
                const saved = localStorage.getItem('fairyTailsStaffBoard');
                if (saved) {
                    try {
                        data = JSON.parse(saved);
                    } catch (e) {
                        console.error('Failed to parse localStorage:', e);
                        return;
                    }
                }
            }
            
            if (!data) return;
            
            const currentData = JSON.stringify({
                today: state.today,
                tomorrow: state.tomorrow
            });
            
            const newToday = {
                dogs: data.today?.dogs || [],
                staging: data.today?.staging || [],
                vanTimes: data.today?.vanTimes || { BV: '07:30', DV: '08:00', SV: '08:30' }
            };
            const newTomorrow = {
                dogs: data.tomorrow?.dogs || [],
                staging: data.tomorrow?.staging || [],
                vanTimes: data.tomorrow?.vanTimes || { BV: '07:30', DV: '08:00', SV: '08:30' }
            };
            
            const newData = JSON.stringify({
                today: newToday,
                tomorrow: newTomorrow
            });
            
            if (currentData !== newData) {
                const oldTodayCount = state.today.dogs.length;
                const oldTomorrowCount = state.tomorrow.dogs.length;
                const newTodayCount = newToday.dogs.length;
                const newTomorrowCount = newTomorrow.dogs.length;
                
                state.today = newToday;
                state.tomorrow = newTomorrow;
                
                populateVanTimeDropdowns();
                renderStaging('today');
                renderStaging('tomorrow');
                renderBoard('today');
                renderBoard('tomorrow');
                
                console.log(`Data refreshed - Today: ${oldTodayCount}â†’${newTodayCount}, Tomorrow: ${oldTomorrowCount}â†’${newTomorrowCount}`);
            }
        }

        // =====================
        // Data Persistence
        // =====================
        
        async function saveBoard() {
            const dataToSave = {
                action: 'save',
                today: { 
                    dogs: state.today.dogs, 
                    staging: state.today.staging,
                    vanTimes: state.today.vanTimes
                },
                tomorrow: { 
                    dogs: state.tomorrow.dogs, 
                    staging: state.tomorrow.staging,
                    vanTimes: state.tomorrow.vanTimes
                }
            };
            
            localStorage.setItem('fairyTailsStaffBoard', JSON.stringify(dataToSave));
            
            if (CONFIG.USE_GOOGLE_SHEETS && CONFIG.SCRIPT_URL) {
                try {
                    const response = await fetch(CONFIG.SCRIPT_URL, {
                        method: 'POST',
                        mode: 'no-cors',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(dataToSave)
                    });
                    showToast('ðŸ’¾ Saved to cloud', 'success');
                } catch (error) {
                    console.error('Failed to save to Google Sheets:', error);
                    showToast('ðŸ’¾ Saved locally (cloud sync failed)', 'warning');
                }
            } else {
                showToast('ðŸ’¾ Board saved', 'success');
            }
        }

        async function loadBoard() {
            let loadedFromSheets = false;
            
            if (CONFIG.USE_GOOGLE_SHEETS && CONFIG.SCRIPT_URL) {
                try {
                    const response = await fetch(`${CONFIG.SCRIPT_URL}?action=load`);
                    const result = await response.json();
                    
                    if (result.success && result.data) {
                        state.today.dogs = result.data.today?.dogs || [];
                        state.today.staging = result.data.today?.staging || [];
                        state.today.vanTimes = result.data.today?.vanTimes || { BV: '07:30', DV: '08:00', SV: '08:30' };
                        state.tomorrow.dogs = result.data.tomorrow?.dogs || [];
                        state.tomorrow.staging = result.data.tomorrow?.staging || [];
                        state.tomorrow.vanTimes = result.data.tomorrow?.vanTimes || { BV: '07:30', DV: '08:00', SV: '08:30' };
                        loadedFromSheets = true;
                        console.log('âœ… Loaded from Google Sheets:', {
                            today: state.today.dogs.length,
                            tomorrow: state.tomorrow.dogs.length
                        });
                    }
                } catch (error) {
                    console.error('âŒ Failed to load from Google Sheets:', error);
                }
            }
            
            if (!loadedFromSheets) {
                console.warn('âš ï¸ Google Sheets unavailable - using localStorage (read-only mode until Sheets connects)');
                const saved = localStorage.getItem('fairyTailsStaffBoard');
                if (saved) {
                    try {
                        const data = JSON.parse(saved);
                        state.today.dogs = data.today?.dogs || [];
                        state.today.staging = data.today?.staging || [];
                        state.today.vanTimes = data.today?.vanTimes || { BV: '07:30', DV: '08:00', SV: '08:30' };
                        state.tomorrow.dogs = data.tomorrow?.dogs || [];
                        state.tomorrow.staging = data.tomorrow?.staging || [];
                        state.tomorrow.vanTimes = data.tomorrow?.vanTimes || { BV: '07:30', DV: '08:00', SV: '08:30' };
                        console.log('ðŸ“¦ Loaded from localStorage (temporary)');
                    } catch (e) {
                        console.error('Failed to load saved data:', e);
                    }
                }
                
                showToast('âš ï¸ Could not connect to Google Sheets - changes may not save', 'error');
            }
            
            populateVanTimeDropdowns();
            
            renderStaging('today');
            renderStaging('tomorrow');
            renderBoard('today');
            renderBoard('tomorrow');
            
            // CRITICAL: Only enable autoSave if we successfully loaded from Google Sheets
            if (loadedFromSheets) {
                state.initialLoadComplete = true;
                console.log('âœ… Initial load complete - autoSave now enabled');
            } else {
                state.initialLoadComplete = false;
                console.warn('âš ï¸ AutoSave DISABLED - waiting for Google Sheets connection');
                setTimeout(retryLoadFromSheets, 10000);
            }
        }
        
        // Retry loading from Google Sheets if initial load failed
        async function retryLoadFromSheets() {
            if (state.initialLoadComplete) return;
            
            console.log('ðŸ”„ Retrying Google Sheets connection...');
            
            if (CONFIG.USE_GOOGLE_SHEETS && CONFIG.SCRIPT_URL) {
                try {
                    const response = await fetch(`${CONFIG.SCRIPT_URL}?action=load`);
                    const result = await response.json();
                    
                    if (result.success && result.data) {
                        const remoteToday = result.data.today?.dogs?.length || 0;
                        const remoteTomorrow = result.data.tomorrow?.dogs?.length || 0;
                        const localToday = state.today.dogs.length;
                        const localTomorrow = state.tomorrow.dogs.length;
                        
                        if (remoteToday >= localToday || remoteTomorrow >= localTomorrow) {
                            state.today.dogs = result.data.today?.dogs || [];
                            state.today.staging = result.data.today?.staging || [];
                            state.today.vanTimes = result.data.today?.vanTimes || state.today.vanTimes;
                            state.tomorrow.dogs = result.data.tomorrow?.dogs || [];
                            state.tomorrow.staging = result.data.tomorrow?.staging || [];
                            state.tomorrow.vanTimes = result.data.tomorrow?.vanTimes || state.tomorrow.vanTimes;
                            
                            populateVanTimeDropdowns();
                            renderStaging('today');
                            renderStaging('tomorrow');
                            renderBoard('today');
                            renderBoard('tomorrow');
                        }
                        
                        state.initialLoadComplete = true;
                        showToast('âœ… Connected to Google Sheets', 'success');
                        console.log('âœ… Reconnected to Google Sheets - autoSave now enabled');
                        return;
                    }
                } catch (error) {
                    console.error('Retry failed:', error);
                }
            }
            
            setTimeout(retryLoadFromSheets, 10000);
        }

        // Auto-save on changes (SMART SAVE with race condition protection)
        async function autoSave(forceLocalOnly = false) {
            // CRITICAL: Never save until initial data load is complete
            if (!state.initialLoadComplete) {
                console.log('Initial load not complete - skipping save to prevent data loss');
                return;
            }
            
            const dataToSave = {
                action: 'save',
                today: { 
                    dogs: state.today.dogs, 
                    staging: state.today.staging,
                    vanTimes: state.today.vanTimes
                },
                tomorrow: { 
                    dogs: state.tomorrow.dogs, 
                    staging: state.tomorrow.staging,
                    vanTimes: state.tomorrow.vanTimes
                }
            };
            
            localStorage.setItem('fairyTailsStaffBoard', JSON.stringify(dataToSave));
            
            if (forceLocalOnly) return;
            
            if (CONFIG.USE_GOOGLE_SHEETS && CONFIG.SCRIPT_URL) {
                try {
                    const localTodayCount = state.today.dogs.length;
                    const localTomorrowCount = state.tomorrow.dogs.length;
                    const localTotal = localTodayCount + localTomorrowCount;
                    
                    console.log(`Checking remote before saving (local: Today=${localTodayCount}, Tomorrow=${localTomorrowCount})...`);
                    
                    try {
                        const response = await fetch(`${CONFIG.SCRIPT_URL}?action=load`);
                        const result = await response.json();
                        
                        if (result.success && result.data) {
                            const remoteTodayCount = result.data.today?.dogs?.length || 0;
                            const remoteTomorrowCount = result.data.tomorrow?.dogs?.length || 0;
                            const remoteTotal = remoteTodayCount + remoteTomorrowCount;
                            
                            if (remoteTotal > localTotal) {
                                console.warn(`âš ï¸ BLOCKED SAVE: Remote has more data (${remoteTotal}) than local (${localTotal})`);
                                showToast('ðŸ”„ Syncing newer data from cloud...', 'info');
                                await loadBoardSilent();
                                return;
                            }
                            
                            if (localTotal === 0 && remoteTotal > 0) {
                                console.warn(`âš ï¸ BLOCKED SAVE: Local is empty but remote has ${remoteTotal} dogs`);
                                await loadBoardSilent();
                                return;
                            }
                        }
                    } catch (checkError) {
                        console.error('Could not verify remote state - skipping save to be safe:', checkError);
                        return;
                    }
                    
                    await fetch(CONFIG.SCRIPT_URL, {
                        method: 'POST',
                        mode: 'no-cors',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(dataToSave)
                    });
                    
                    console.log(`âœ… Saved to Google Sheets (Today: ${localTodayCount}, Tomorrow: ${localTomorrowCount})`);
                    
                } catch (error) {
                    console.error('Auto-save to Google Sheets failed:', error);
                }
            }
        }

        // Periodic outbound save (website â†’ Sheets) every 94 seconds
        setInterval(autoSave, 94000);

        // Periodic inbound refresh (Sheets â†’ website) every 93 seconds
        setInterval(loadBoardSilent, 93000);

        // =====================
        // Initialization
        // =====================
        function init() {
            updateTime();
            setInterval(updateTime, 1000);
            loadBoard();
        }

        // Start the app
        init();
    </script>
</body>
</html>

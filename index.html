<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Fairy Tails K9 Centre - Staff Board</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --brand-blue: #00acee;
            --brand-blue-dark: #007ba8;
            --brand-gradient: linear-gradient(135deg, #00acee 0%, #007ba8 100%);
            --success-green: #22c55e;
            --warning-amber: #f59e0b;
            --bg-light: #f8fafc;
            --bg-white: #ffffff;
            --text-dark: #1e293b;
            --text-muted: #64748b;
            --border-light: #e2e8f0;
            --shadow-sm: 0 1px 2px rgba(0,0,0,0.05);
            --shadow-md: 0 4px 6px -1px rgba(0,0,0,0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0,0,0,0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Nunito', sans-serif;
            background: var(--bg-light);
            color: var(--text-dark);
            min-height: 100vh;
            overflow-x: hidden;
            /* Safe area padding for notched phones */
            padding-left: env(safe-area-inset-left);
            padding-right: env(safe-area-inset-right);
            padding-bottom: env(safe-area-inset-bottom);
        }

        /* ===== Global Touch-Friendly Styles ===== */

        /* Remove tap highlight flash on Android/iOS */
        button, select, input, a, label, .photo-checkbox, .delete-btn, .tab-btn, .btn, .grooming-select, .grooming-van-select, .bs-date-input, .bs-crate-select {
            -webkit-tap-highlight-color: transparent;
        }

        /* Reduce 300ms tap delay on all interactive elements (all platforms) */
        button, select, input, a, label, .tab-btn, .btn {
            touch-action: manipulation;
        }

        /* Touch feedback â€” pressed state for buttons */
        .btn:active, .tab-btn:active, .refresh-btn:active {
            transform: scale(0.95) !important;
            opacity: 0.85;
        }

        .delete-btn:active {
            transform: scale(0.9);
            background: #ef4444;
            color: white;
        }

        .photo-checkbox:active {
            transform: scale(0.9);
        }

        /* Ensure smooth momentum scrolling on iOS for staging list */
        .staging-dogs {
            -webkit-overflow-scrolling: touch;
        }

        /* Header */
        .header {
            background: var(--brand-gradient);
            color: white;
            padding: 1rem 1.5rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: var(--shadow-md);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .logo {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid white;
        }

        .header-title {
            font-size: 1.5rem;
            font-weight: 800;
        }

        .header-subtitle {
            font-size: 0.875rem;
            opacity: 0.9;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .current-time {
            font-size: 1.25rem;
            font-weight: 700;
        }



        .refresh-btn {
            padding: 0.6rem 0.9rem;
            border-radius: 8px;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid #fbbf24;
            background: #f59e0b;
            color: white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .refresh-btn:hover {
            background: #d97706;
            border-color: #d97706;
            transform: rotate(180deg);
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }

        .refresh-btn.refreshing {
            animation: spin 1s linear infinite;
            background: #3b82f6;
            border-color: #3b82f6;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }



        /* Tab Navigation */
        .tab-nav {
            display: flex;
            background: var(--bg-white);
            border-bottom: 2px solid var(--border-light);
            padding: 0 1rem;
        }

        .tab-btn {
            padding: 1rem 2rem;
            font-size: 1.1rem;
            font-weight: 700;
            border: none;
            background: transparent;
            cursor: pointer;
            color: var(--text-muted);
            border-bottom: 3px solid transparent;
            margin-bottom: -2px;
            transition: all 0.2s ease;
        }

        .tab-btn:hover {
            color: var(--brand-blue);
        }

        .tab-btn.active {
            color: var(--brand-blue);
            border-bottom-color: var(--brand-blue);
        }

        .tab-actions {
            margin-left: auto;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 0;
        }

        /* Buttons */
        .btn {
            padding: 0.625rem 1.25rem;
            font-size: 0.9rem;
            font-weight: 700;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.2s ease;
            font-family: inherit;
        }

        .btn-primary {
            background: var(--brand-gradient);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        .btn-success {
            background: var(--success-green);
            color: white;
        }

        .btn-success:hover {
            background: #16a34a;
        }

        .btn-outline {
            background: transparent;
            border: 2px solid var(--border-light);
            color: var(--text-dark);
        }

        .btn-outline:hover {
            border-color: var(--brand-blue);
            color: var(--brand-blue);
        }

        .btn-danger {
            background: #ef4444;
            color: white;
        }

        .btn-danger:hover {
            background: #dc2626;
        }

        .btn-small {
            padding: 0.375rem 0.75rem;
            font-size: 0.8rem;
        }

        /* Tab Content */
        .tab-content {
            display: none;
            padding: 1rem;
        }

        .tab-content.active {
            display: block;
        }

        /* Staging Area */
        .staging-area {
            background: var(--bg-white);
            border-radius: 16px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            box-shadow: var(--shadow-sm);
            border: 2px solid var(--border-light);
        }

        .staging-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1rem;
        }

        .staging-title {
            font-size: 1.1rem;
            font-weight: 800;
            color: var(--text-dark);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .staging-count {
            background: var(--brand-blue);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.875rem;
        }

        .staging-input-row {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .staging-input {
            flex: 1;
            padding: 0.75rem 1rem;
            font-size: 1rem;
            border: 2px solid var(--border-light);
            border-radius: 8px;
            font-family: inherit;
            font-weight: 600;
        }

        .staging-input:focus {
            outline: none;
            border-color: var(--brand-blue);
        }

        .service-type-select {
            padding: 0.75rem 1rem;
            border: 2px solid var(--border-light);
            border-radius: 8px;
            font-size: 0.9rem;
            font-family: inherit;
            font-weight: 600;
            background: white;
            cursor: pointer;
            min-width: 140px;
        }

        .service-type-select:focus {
            outline: none;
            border-color: var(--brand-blue);
        }

        .staging-dogs {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            min-height: 50px;
            padding: 1rem;
            background: #f8fafc;
            border-radius: 8px;
            border: 2px dashed var(--border-light);
        }

        .staging-dogs:empty::before {
            content: 'No dogs added yet â€” type a name above and press Enter or click Add';
            color: var(--text-muted);
            font-style: italic;
        }

        .staged-dog {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            background: var(--brand-gradient);
            color: white;
            padding: 0.5rem 0.75rem;
            border-radius: 8px;
            font-weight: 600;
            font-size: 0.95rem;
            animation: popIn 0.2s ease;
        }

        @keyframes popIn {
            from { transform: scale(0.8); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .staged-dog-remove {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.2s ease;
            /* Expand touch target beyond visual size */
            position: relative;
        }

        .staged-dog-remove::before {
            content: '';
            position: absolute;
            top: -8px;
            left: -8px;
            right: -8px;
            bottom: -8px;
        }

        .staged-dog-remove:hover {
            background: rgba(255,255,255,0.4);
        }

        .staging-actions {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
            justify-content: flex-end;
        }

        /* Stats Bar */
        .stats-bar {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }

        .stat-card {
            background: var(--bg-white);
            border-radius: 12px;
            padding: 1rem 1.5rem;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-light);
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .stat-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

        .stat-icon.dogs { background: #dbeafe; }
        .stat-icon.photos { background: #dcfce7; }
        .stat-icon.walks { background: #fef3c7; }
        .stat-icon.vans { background: #f3e8ff; }

        .stat-value {
            font-size: 1.75rem;
            font-weight: 800;
            line-height: 1;
        }

        .stat-label {
            font-size: 0.875rem;
            color: var(--text-muted);
        }

        /* Van Legend */
        .van-legend {
            display: flex;
            gap: 1rem;
            padding: 1rem;
            background: var(--bg-white);
            border-radius: 12px;
            margin-bottom: 1rem;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-light);
            flex-wrap: wrap;
            align-items: center;
        }

        .van-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 600;
        }

        .van-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 6px;
            font-size: 0.85rem;
            font-weight: 700;
        }

        .van-badge.bv { background: #dbeafe; color: #1d4ed8; }
        .van-badge.dv { background: #fef3c7; color: #b45309; }
        .van-badge.sv { background: #dcfce7; color: #15803d; }

        .van-time-select {
            padding: 0.3rem 0.5rem;
            border: 2px solid var(--border-light);
            border-radius: 6px;
            font-size: 0.85rem;
            font-family: inherit;
            font-weight: 600;
            cursor: pointer;
            background: white;
        }

        .van-time-select:focus {
            outline: none;
            border-color: var(--brand-blue);
        }

        /* Board Container - Dynamic Columns */
        .board-container {
            display: grid;
            gap: 1rem;
        }

        .board-container.cols-1 { grid-template-columns: 1fr; }
        .board-container.cols-2 { grid-template-columns: repeat(2, 1fr); }
        .board-container.cols-3 { grid-template-columns: repeat(3, 1fr); }
        .board-container.cols-4 { grid-template-columns: repeat(4, 1fr); }

        /* Mobile: Stack columns vertically for comfortable editing */
        @media (max-width: 1400px) {
            .board-container.cols-4,
            .board-container.cols-5,
            .board-container.cols-6 { grid-template-columns: repeat(3, 1fr); }
        }

        @media (max-width: 1100px) {
            .board-container.cols-3,
            .board-container.cols-4,
            .board-container.cols-5,
            .board-container.cols-6 { grid-template-columns: repeat(2, 1fr); }
            
            /* Tablet: Ensure touch targets meet 44px minimum */
            .photo-checkbox {
                width: 36px;
                height: 36px;
            }
            
            .delete-btn {
                width: 36px;
                height: 36px;
            }
            
            .vp-select {
                min-height: 38px;
            }
            
            .stop-select {
                min-height: 38px;
            }
            
            .walk-select {
                min-height: 38px;
            }
            
            .notes-input {
                min-height: 38px;
            }
        }

        @media (max-width: 768px) {
            .board-container.cols-2,
            .board-container.cols-3,
            .board-container.cols-4,
            .board-container.cols-5,
            .board-container.cols-6 { grid-template-columns: 1fr; }
            
            /* ===== Mobile Dog Rows: Card layout ===== */
            /* Row 1: Name | Photo âœ“ | Walk | Delete Ã— */
            /* Row 2: VP Controls (AM/PM) | Notes toggle ðŸ“ */
            /* Row 3 (conditional): Full-width notes text input */
            
            /* Hide table header â€” card layout has inline labels */
            .table-header {
                display: none;
            }
            
            .dog-row {
                display: grid;
                grid-template-columns: 1fr 48px minmax(80px, 110px) 44px;
                grid-template-rows: auto auto 0fr;
                gap: 0.4rem 0.35rem;
                padding: 0.75rem 0.75rem 0.65rem;
                margin: 0.5rem 0.4rem;
                border-radius: 12px;
                border-width: 2px;
                border-left-width: 6px;
                box-shadow: 0 2px 6px rgba(0,0,0,0.08);
                transition: grid-template-rows 0.25s ease, all 0.2s ease;
            }
            
            /* When notes expanded, row 3 opens up */
            .dog-row.notes-expanded {
                grid-template-rows: auto auto 1fr;
            }
            
            /* Row 1 placement */
            .dog-row .dog-name {
                grid-column: 1;
                grid-row: 1;
                font-size: 1.1rem;
                font-weight: 800;
                align-self: center;
            }
            
            .dog-row .photo-check {
                grid-column: 2;
                grid-row: 1;
                align-self: center;
                justify-self: center;
                position: relative;
            }
            
            /* Mobile inline label: Photo */
            .dog-row .photo-check::before {
                content: 'ðŸ“¸';
                position: absolute;
                top: -14px;
                left: 50%;
                transform: translateX(-50%);
                font-size: 0.6rem;
                color: var(--text-muted);
                white-space: nowrap;
            }
            
            .dog-row .walk-select {
                grid-column: 3;
                grid-row: 1;
                align-self: center;
            }
            
            .dog-row .delete-btn {
                grid-column: 4;
                grid-row: 1;
                justify-self: center;
                align-self: center;
            }
            
            /* ===== Row 2: VP Controls + Notes Toggle ===== */
            
            .dog-row .vp-control {
                grid-column: 1 / 4;
                grid-row: 2;
                padding-top: 0.5rem;
                margin-top: 0.25rem;
                border-top: 2px solid var(--border-light);
                flex-wrap: nowrap;
                justify-content: flex-start;
            }
            
            /* Show AM/PM labels on mobile */
            .vp-group-label {
                display: block !important;
                font-size: 0.6rem;
                font-weight: 800;
                color: var(--text-muted);
                text-transform: uppercase;
                letter-spacing: 0.05em;
                margin-right: 3px;
                flex-shrink: 0;
                min-width: 20px;
            }
            
            /* Prominent divider on mobile */
            .vp-divider {
                width: 3px;
                height: 36px;
                background: var(--text-muted);
                margin: 0 6px;
                border-radius: 2px;
                opacity: 0.4;
            }
            
            /* Prevent flex-shrink clipping any selects */
            .vp-group > select {
                flex-shrink: 0;
            }
            
            /* Notes toggle switch â€” visible on mobile */
            .notes-toggle {
                display: flex !important;
                grid-column: 4;
                grid-row: 2;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                justify-self: center;
                align-self: center;
                gap: 3px;
                cursor: pointer;
                -webkit-tap-highlight-color: transparent;
            }
            
            .notes-toggle-label {
                font-size: 0.65rem;
                line-height: 1;
            }
            
            /* The pill-shaped track */
            .toggle-track {
                width: 40px;
                height: 22px;
                background: #cbd5e1;
                border-radius: 11px;
                position: relative;
                transition: background 0.25s ease;
                flex-shrink: 0;
            }
            
            /* The sliding circle knob */
            .toggle-knob {
                width: 18px;
                height: 18px;
                background: white;
                border-radius: 50%;
                position: absolute;
                top: 2px;
                left: 2px;
                transition: transform 0.25s ease;
                box-shadow: 0 1px 3px rgba(0,0,0,0.25);
            }
            
            .notes-toggle:active .toggle-knob {
                width: 22px;
                border-radius: 9px;
            }
            
            /* ON state â€” green track, knob slides right */
            .dog-row.notes-expanded .toggle-track {
                background: #22c55e;
            }
            
            .dog-row.notes-expanded .toggle-knob {
                transform: translateX(18px);
            }
            
            .dog-row.notes-expanded .notes-toggle:active .toggle-knob {
                transform: translateX(14px);
            }
            
            /* Has notes content but panel is closed â€” amber track */
            .notes-toggle.has-notes .toggle-track {
                background: #f59e0b;
            }
            
            /* When expanded, green overrides amber */
            .dog-row.notes-expanded .notes-toggle.has-notes .toggle-track {
                background: #22c55e;
            }
            
            /* ===== Row 3: Notes input (conditional) ===== */
            
            .dog-row .notes-input {
                grid-column: 1 / 5;
                grid-row: 3;
                font-size: 16px;
                min-height: 44px;
                padding: 0.5rem;
                border-radius: 8px;
                overflow: hidden;
                opacity: 0;
                min-height: 0;
                padding: 0;
                margin: 0;
                border-width: 0;
                transition: all 0.25s ease;
            }
            
            /* Expanded state â€” notes input visible */
            .dog-row.notes-expanded .notes-input {
                opacity: 1;
                min-height: 44px;
                padding: 0.5rem;
                margin-top: 0.25rem;
                border-width: 2px;
            }
            
            /* ===== Boarding Mobile: AM only + Crate ===== */
            /* Row 1: Name | Photo | Walk | Delete */
            /* Row 2: AM VP | Crate | Notes toggle */
            /* Row 3 (conditional): Notes input */
            
            .dog-row.boarding {
                grid-template-columns: 1fr 48px minmax(80px, 110px) 44px;
            }
            
            .dog-row.boarding .vp-control-am {
                grid-column: 1 / 2;
                grid-row: 2;
                padding-top: 0.5rem;
                margin-top: 0.25rem;
                border-top: 2px solid var(--border-light);
            }
            
            .dog-row.boarding .crate-select {
                grid-column: 2 / 3;
                grid-row: 2;
                align-self: center;
                justify-self: center;
                width: 52px;
                min-height: 44px;
                font-size: 16px;
                padding: 0.3rem 0.1rem;
                margin-top: 0.25rem;
                border-top: 2px solid var(--border-light);
                padding-top: 0.5rem;
                border-radius: 8px;
            }
            
            .dog-row.boarding .walk-select {
                grid-column: 3;
                grid-row: 1;
            }
            
            .dog-row.boarding .notes-toggle {
                grid-column: 3;
                grid-row: 2;
                justify-self: center;
                margin-top: 0.25rem;
                border-top: 2px solid var(--border-light);
                padding-top: 0.5rem;
            }
            
            .dog-row.boarding .notes-input {
                grid-column: 1 / 5;
                grid-row: 3;
            }
            
            /* ===== Grooming Mobile: Card layout ===== */
            /* Row 1: Name | Delete */
            /* Row 2: Pick Up | Drop Off | Van Type */
            
            .dog-row.grooming {
                grid-template-columns: 1fr 44px;
                grid-template-rows: auto auto;
                gap: 0.4rem 0.35rem;
            }
            
            .dog-row.grooming .dog-name {
                grid-column: 1;
                grid-row: 1;
                font-size: 1.1rem;
                font-weight: 800;
                align-self: center;
            }
            
            .dog-row.grooming .delete-btn {
                grid-column: 2;
                grid-row: 1;
                justify-self: center;
                align-self: center;
            }
            
            /* Pick Up, Drop Off, Van Type all flow into row 2, spanning full width */
            .dog-row.grooming .grooming-pickup {
                grid-column: 1;
                grid-row: 2;
                padding-top: 0.5rem;
                margin-top: 0.25rem;
                border-top: 2px solid var(--border-light);
                min-height: 44px;
                font-size: 16px;
            }
            
            .dog-row.grooming .grooming-dropoff {
                grid-column: 2;
                grid-row: 2;
                padding-top: 0.5rem;
                margin-top: 0.25rem;
                border-top: 2px solid var(--border-light);
                min-height: 44px;
                font-size: 16px;
            }
            
            /* Use a 3-column sub-layout for row 2 */
            .dog-row.grooming {
                grid-template-columns: 1fr 1fr 70px 44px;
                grid-template-rows: auto auto;
            }
            
            .dog-row.grooming .dog-name {
                grid-column: 1 / 4;
                grid-row: 1;
            }
            
            .dog-row.grooming .delete-btn {
                grid-column: 4;
                grid-row: 1;
            }
            
            .dog-row.grooming .grooming-pickup {
                grid-column: 1;
                grid-row: 2;
            }
            
            .dog-row.grooming .grooming-dropoff {
                grid-column: 2;
                grid-row: 2;
            }
            
            .dog-row.grooming .grooming-van-select {
                grid-column: 3;
                grid-row: 2;
                padding-top: 0.5rem;
                margin-top: 0.25rem;
                border-top: 2px solid var(--border-light);
                min-height: 44px;
                font-size: 16px;
            }
            
            /* ===== Boarding School Mobile: Card layout ===== */
            /* Row 1: Name | Delete */
            /* Row 2: Check In | Check Out | Crate Size */
            
            .dog-row.boarding-school {
                grid-template-columns: 1fr 1fr 80px 44px;
                grid-template-rows: auto auto;
                gap: 0.4rem 0.35rem;
            }
            
            .dog-row.boarding-school .dog-name {
                grid-column: 1 / 4;
                grid-row: 1;
                font-size: 1.1rem;
                font-weight: 800;
                align-self: center;
            }
            
            .dog-row.boarding-school .delete-btn {
                grid-column: 4;
                grid-row: 1;
                justify-self: center;
                align-self: center;
            }
            
            .dog-row.boarding-school .bs-checkin {
                grid-column: 1;
                grid-row: 2;
                padding-top: 0.5rem;
                margin-top: 0.25rem;
                border-top: 2px solid var(--border-light);
                min-height: 44px;
                font-size: 16px;
            }
            
            .dog-row.boarding-school .bs-checkout {
                grid-column: 2;
                grid-row: 2;
                padding-top: 0.5rem;
                margin-top: 0.25rem;
                border-top: 2px solid var(--border-light);
                min-height: 44px;
                font-size: 16px;
            }
            
            .dog-row.boarding-school .bs-crate-select {
                grid-column: 3;
                grid-row: 2;
                padding-top: 0.5rem;
                margin-top: 0.25rem;
                border-top: 2px solid var(--border-light);
                min-height: 44px;
                font-size: 16px;
            }
            
            /* ===== Touch Targets: Minimum 44px ===== */
            
            .photo-checkbox {
                width: 44px;
                height: 44px;
            }
            
            .photo-checkbox:checked::after {
                font-size: 1.3rem;
            }
            
            .delete-btn {
                width: 44px;
                height: 44px;
                font-size: 1.3rem;
                border-radius: 8px;
            }
            
            /* Walk select â€” full touch height, prevent iOS zoom */
            .walk-select {
                font-size: 16px;
                min-height: 44px;
                padding: 0.5rem 0.4rem;
                border-radius: 8px;
            }
            
            /* VP selects â€” enlarged for fingers */
            .vp-select {
                width: 44px;
                min-height: 44px;
                font-size: 16px;
                padding: 0.4rem 0.15rem;
                border-radius: 0;
            }
            
            .vp-select.vp-am {
                border-left: 2px solid var(--border-light);
            }
            
            /* Stop selects â€” enlarged for fingers */
            .stop-select {
                width: 40px;
                min-height: 44px;
                font-size: 16px;
                padding: 0.4rem 0.15rem;
            }
            
            .stop-select.stop-am {
                border-radius: 8px 0 0 8px;
            }
            
            .stop-select.stop-pm {
                border-radius: 0 8px 8px 0;
            }
            
            /* ===== Staging Area: Stacked for touch ===== */
            
            .staging-input-row {
                flex-wrap: wrap;
                gap: 0.5rem;
            }
            
            .staging-input {
                flex: 1 1 100%;
                font-size: 16px;
                min-height: 48px;
            }
            
            .service-type-select {
                flex: 1 1 0;
                min-width: 0;
                font-size: 16px;
                min-height: 48px;
            }
            
            .staging-input-row .btn-primary {
                flex: 0 0 auto;
                min-height: 48px;
                font-size: 1rem;
                padding: 0.6rem 1.25rem;
            }
            
            .staging-area .btn {
                min-height: 48px;
                font-size: 1rem;
            }
            
            /* Staged dog tags â€” touch-friendly sizing */
            .staged-dog {
                padding: 0.6rem 0.85rem;
                font-size: 1rem;
            }
            
            .staged-dog-remove {
                width: 32px;
                height: 32px;
                font-size: 1.1rem;
            }
            
            /* ===== Buttons: Touch-friendly minimums ===== */
            
            .btn {
                min-height: 44px;
                padding: 0.6rem 1rem;
                font-size: 0.95rem;
            }
            
            .btn-small {
                min-height: 40px;
                padding: 0.5rem 0.75rem;
            }
            
            /* ===== Compact Header ===== */
            
            .header {
                padding: 0.75rem 1rem;
            }
            
            .header-title {
                font-size: 1.2rem;
            }
            
            .logo {
                width: 40px;
                height: 40px;
            }
            
            .refresh-btn {
                width: 44px;
                height: 44px;
                display: flex;
                align-items: center;
                justify-content: center;
            }
            
            /* ===== Stats: 2Ã—2 Grid ===== */
            
            .stats-bar {
                display: grid;
                grid-template-columns: repeat(2, 1fr);
            }
            
            .stat-card {
                padding: 0.75rem 1rem;
            }
            
            .stat-value {
                font-size: 1.5rem;
            }
            
            /* ===== Van Legend: Stacked ===== */
            
            .van-legend {
                flex-direction: column;
                gap: 0.75rem;
                align-items: flex-start;
            }
            
            .van-item {
                justify-content: flex-start;
                width: 100%;
            }
            
            .van-time-select {
                font-size: 16px;
                min-height: 44px;
                padding: 0.5rem;
            }
            
            /* ===== Tab Navigation ===== */
            
            .tab-nav {
                flex-wrap: wrap;
                padding: 0.5rem;
            }
            
            .tab-btn {
                padding: 0.75rem 1rem;
                font-size: 1rem;
                min-height: 44px;
            }
            
            .tab-actions {
                width: 100%;
                justify-content: center;
                flex-wrap: wrap;
                padding-top: 0.5rem;
                gap: 0.5rem;
            }
            
            .tab-actions .btn {
                flex: 1;
                min-width: 0;
                text-align: center;
                justify-content: center;
            }
        }
        
        /* ===== Very Small Phones (< 400px) ===== */
        @media (max-width: 400px) {
            .dog-row {
                grid-template-columns: 1fr 44px minmax(70px, 90px) 40px;
                padding: 0.6rem 0.5rem;
            }
            
            .dog-name {
                font-size: 0.9rem;
            }
            
            .vp-select {
                width: 40px;
            }
            
            .stop-select {
                width: 36px;
            }
            
            .header-left .header-subtitle {
                display: none;
            }
            
            .stat-card {
                padding: 0.5rem 0.75rem;
            }
            
            .stat-value {
                font-size: 1.25rem;
            }
            
            .stat-icon {
                width: 36px;
                height: 36px;
                font-size: 1.1rem;
            }
        }

        /* Board Column */
        .board-column {
            background: var(--bg-white);
            border-radius: 16px;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-light);
            overflow: clip;
        }

        /* Service Type Sections */
        .service-section {
            margin-bottom: 1.5rem;
        }

        .service-section:last-child {
            margin-bottom: 0;
        }

        .section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.75rem 1rem;
            font-weight: 800;
            font-size: 1rem;
            border-radius: 12px 12px 0 0;
            margin-bottom: 0;
        }

        .section-header .section-icon {
            margin-right: 0.5rem;
        }

        .section-header .section-count {
            background: rgba(255,255,255,0.3);
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 700;
        }

        /* Half Day AM - Orange/Amber theme */
        .section-header.half-day-am {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
        }

        .section-row.half-day-am {
            background: #fffbeb;
            border-left: 4px solid #f59e0b;
        }

        /* Full Day - Blue theme (default) */
        .section-header.full-day {
            background: var(--brand-gradient);
            color: white;
        }

        .section-row.full-day {
            background: white;
            border-left: 4px solid var(--brand-blue);
        }

        /* Boarding - Purple theme */
        .section-header.boarding {
            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
            color: white;
        }

        .section-row.boarding {
            background: #f5f3ff;
            border-left: 4px solid #8b5cf6;
        }

        /* Grooming Dogs - Teal/Cyan theme */
        .section-header.grooming {
            background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%);
            color: white;
        }

        .section-row.grooming {
            background: #ecfeff;
            border-left: 4px solid #06b6d4;
        }

        /* Boarding School - Rose/Pink theme */
        .section-header.boarding-school {
            background: linear-gradient(135deg, #f43f5e 0%, #e11d48 100%);
            color: white;
        }

        .section-row.boarding-school {
            background: #fff1f2;
            border-left: 4px solid #f43f5e;
        }

        /* Grooming-specific grid: Name | Pick Up | Drop Off | Van Type | Delete */
        .table-header.grooming-header {
            grid-template-columns: 2fr 110px 110px 70px 32px;
        }

        .dog-row.grooming {
            grid-template-columns: 2fr 110px 110px 70px 32px;
        }

        /* Grooming pickup/dropoff select styling */
        .grooming-select {
            width: 100%;
            padding: 0.35rem 0.25rem;
            border: 2px solid var(--border-light);
            border-radius: 6px;
            font-size: 0.8rem;
            font-family: inherit;
            font-weight: 600;
            background: white;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .grooming-select:focus {
            border-color: #06b6d4;
            outline: none;
            box-shadow: 0 0 0 3px rgba(6, 182, 212, 0.15);
        }

        .grooming-select.has-value {
            background: #ecfeff;
            border-color: #06b6d4;
            color: #0e7490;
        }

        /* Grooming van type select styling */
        .grooming-van-select {
            width: 100%;
            padding: 0.35rem 0.25rem;
            border: 2px solid var(--border-light);
            border-radius: 6px;
            font-size: 0.8rem;
            font-family: inherit;
            font-weight: 700;
            background: white;
            cursor: pointer;
            text-align: center;
            transition: all 0.2s ease;
        }

        .grooming-van-select:focus {
            border-color: #06b6d4;
            outline: none;
            box-shadow: 0 0 0 3px rgba(6, 182, 212, 0.15);
        }

        .grooming-van-select.has-value {
            background: #ecfeff;
            border-color: #06b6d4;
            color: #0e7490;
        }

        /* Boarding School-specific grid: Name | Check In | Check Out | Crate Size | Delete */
        .table-header.boarding-school-header {
            grid-template-columns: 2fr 120px 120px 80px 32px;
        }

        .dog-row.boarding-school {
            grid-template-columns: 2fr 120px 120px 80px 32px;
        }

        /* Boarding School date input styling */
        .bs-date-input {
            width: 100%;
            padding: 0.35rem 0.25rem;
            border: 2px solid var(--border-light);
            border-radius: 6px;
            font-size: 0.8rem;
            font-family: inherit;
            font-weight: 600;
            background: white;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .bs-date-input:focus {
            border-color: #f43f5e;
            outline: none;
            box-shadow: 0 0 0 3px rgba(244, 63, 94, 0.15);
        }

        .bs-date-input:not(:placeholder-shown),
        .bs-date-input.has-value {
            background: #fff1f2;
            border-color: #f43f5e;
            color: #be123c;
        }

        /* Boarding School crate size select styling */
        .bs-crate-select {
            width: 100%;
            padding: 0.35rem 0.25rem;
            border: 2px solid var(--border-light);
            border-radius: 6px;
            font-size: 0.8rem;
            font-family: inherit;
            font-weight: 700;
            background: white;
            cursor: pointer;
            text-align: center;
            transition: all 0.2s ease;
        }

        .bs-crate-select:focus {
            border-color: #f43f5e;
            outline: none;
            box-shadow: 0 0 0 3px rgba(244, 63, 94, 0.15);
        }

        .bs-crate-select.has-value {
            background: #fff1f2;
            border-color: #f43f5e;
            color: #be123c;
        }

        /* Boarding-specific grid: Name | Photo | Walk | AM | Crate | Notes | Delete */
        .table-header.boarding-header {
            grid-template-columns: 2fr 50px 80px 90px 70px 1.5fr 32px;
        }

        .dog-row.boarding {
            grid-template-columns: 2fr 50px 80px 90px 70px 1.5fr 32px;
        }

        /* Crate select styling */
        .crate-select {
            width: 100%;
            padding: 0.35rem 0.25rem;
            border: 2px solid var(--border-light);
            border-radius: 6px;
            font-size: 0.8rem;
            font-family: inherit;
            font-weight: 700;
            background: white;
            cursor: pointer;
            text-align: center;
            transition: all 0.2s ease;
        }

        .crate-select:focus {
            border-color: #8b5cf6;
            outline: none;
            box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.15);
        }

        .crate-select.has-value {
            background: #f5f3ff;
            border-color: #8b5cf6;
            color: #6d28d9;
        }

        /* Boarding AM-only VP control â€” narrower, no PM */
        .vp-control-am {
            display: flex;
            align-items: center;
            gap: 0;
        }

        /* Section content wrapper */
        .section-content {
            background: var(--bg-white);
            border: 1px solid var(--border-light);
            border-top: none;
            border-radius: 0 0 12px 12px;
            /* overflow:clip rounds corners without creating a scroll container */
            overflow: clip;
        }

        .column-header {
            background: var(--brand-gradient);
            color: white;
            padding: 0.75rem 1rem;
            font-weight: 700;
            font-size: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .column-count {
            background: rgba(255,255,255,0.2);
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.875rem;
        }

        /* Table Header */
        .table-header {
            display: grid;
            grid-template-columns: 2fr 50px 80px 140px 1.5fr 32px;
            gap: 0.25rem;
            padding: 0.5rem 0.75rem;
            background: #f1f5f9;
            font-weight: 700;
            font-size: 0.7rem;
            text-transform: uppercase;
            color: var(--text-muted);
            border-bottom: 1px solid var(--border-light);
        }

        /* Dog Row */
        .dog-rows {
            /* Force all dogs visible â€” no mini scroll within sections */
            max-height: none !important;
            overflow: visible !important;
            height: auto !important;
        }

        .dog-row {
            display: grid;
            grid-template-columns: 2fr 50px 80px 140px 1.5fr 32px;
            gap: 0.25rem;
            padding: 0.4rem 0.75rem;
            border-bottom: 1px solid var(--border-light);
            align-items: center;
            transition: background 0.15s ease;
        }

        .dog-row:hover {
            background: #f8fafc;
        }

        .dog-row:last-child {
            border-bottom: none;
        }

        /* Dog Name Display */
        .dog-name {
            font-weight: 700;
            font-size: 0.95rem;
            color: var(--text-dark);
            padding: 0.4rem 0;
        }

        /* Form Controls */
        .photo-check {
            display: flex;
            justify-content: center;
        }

        .photo-checkbox {
            width: 28px;
            height: 28px;
            appearance: none;
            border: 2px solid var(--border-light);
            border-radius: 6px;
            cursor: pointer;
            position: relative;
            transition: all 0.2s ease;
        }

        .photo-checkbox:checked {
            background: var(--success-green);
            border-color: var(--success-green);
        }

        .photo-checkbox:checked::after {
            content: 'âœ“';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 1rem;
            font-weight: 700;
        }

        /* Walk Select */
        .walk-select {
            width: 100%;
            padding: 0.4rem;
            border: 2px solid var(--border-light);
            border-radius: 6px;
            font-size: 0.8rem;
            font-family: inherit;
            font-weight: 600;
            cursor: pointer;
            background: white;
        }

        .walk-select:focus {
            outline: none;
            border-color: var(--brand-blue);
        }

        .walk-select.walk-booked {
            background: #fef3c7;
            border-color: var(--warning-amber);
        }

        .walk-select.walk-transferred {
            background: #dcfce7;
            border-color: var(--success-green);
        }

        /* V/P Control - AM/PM */
        .vp-control {
            display: flex;
            align-items: center;
            gap: 0;
        }

        .vp-select {
            width: 36px;
            padding: 0.35rem 0.1rem;
            border: 2px solid var(--border-light);
            border-radius: 0;
            font-size: 0.75rem;
            font-family: inherit;
            font-weight: 700;
            cursor: pointer;
            background: white;
            text-align: center;
            appearance: none;
            -webkit-appearance: none;
        }

        .vp-select.vp-am {
            border-left: none;
        }

        .vp-select.vp-pm {
            border-left: none;
        }

        .vp-select:focus {
            outline: none;
            border-color: var(--brand-blue);
            z-index: 1;
        }

        /* Van pickup styles - V (legacy) and BV use blue */
        .vp-select.van-pickup,
        .vp-select.van-bv {
            background: #dbeafe;
            border-color: #3b82f6;
            color: #1e40af;
            position: relative;
            z-index: 1;
        }

        /* SV - Small Van - green */
        .vp-select.van-sv {
            background: #d1fae5;
            border-color: #10b981;
            color: #065f46;
            position: relative;
            z-index: 1;
        }

        /* DV - Dispatch/Dog Van - amber */
        .vp-select.van-dv {
            background: #fef3c7;
            border-color: #f59e0b;
            color: #92400e;
            position: relative;
            z-index: 1;
        }

        .vp-select.parent-pickup {
            background: #f3e8ff;
            border-color: #a855f7;
            color: #7c3aed;
            position: relative;
            z-index: 1;
        }

        /* Stop selects - AM on left, PM on right (dropdown 1-20) */
        .stop-select {
            width: 36px;
            padding: 0.3rem 0.1rem;
            border: 2px solid var(--border-light);
            font-size: 0.75rem;
            font-family: inherit;
            font-weight: 700;
            text-align: center;
            background: white;
            cursor: pointer;
            appearance: none;
            -webkit-appearance: none;
        }

        .stop-select.stop-am {
            border-radius: 6px 0 0 6px;
        }

        .stop-select.stop-pm {
            border-radius: 0 6px 6px 0;
            border-left: none;
        }

        .stop-select:focus {
            outline: none;
            border-color: var(--brand-blue);
            z-index: 1;
        }

        .stop-select:disabled {
            background: #f1f5f9;
            color: #94a3b8;
            cursor: not-allowed;
        }

        .stop-select.has-value:not(:disabled) {
            background: #dbeafe;
            border-color: #3b82f6;
            color: #1e40af;
            position: relative;
            z-index: 1;
        }

        /* Notes Input */
        .notes-input {
            width: 100%;
            padding: 0.4rem;
            border: 2px solid var(--border-light);
            border-radius: 6px;
            font-size: 0.8rem;
            font-family: inherit;
            transition: border-color 0.2s ease;
        }

        .notes-input:focus {
            outline: none;
            border-color: var(--brand-blue);
        }

        .notes-input:not(:placeholder-shown) {
            background: #fffbeb;
            border-color: var(--warning-amber);
        }

        /* Delete Button */
        .delete-btn {
            width: 28px;
            height: 28px;
            border: none;
            background: #fee2e2;
            color: #ef4444;
            cursor: pointer;
            border-radius: 6px;
            font-size: 1.1rem;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .delete-btn:hover {
            background: #ef4444;
            color: white;
        }

        /* Notes Toggle Button â€” hidden on desktop (notes always visible) */
        .notes-toggle {
            display: none;
        }

        /* Empty Board State */
        .empty-board {
            text-align: center;
            padding: 4rem 2rem;
            color: var(--text-muted);
        }

        .empty-board-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
        }

        .empty-board-text {
            font-size: 1.1rem;
            margin-bottom: 0.5rem;
        }

        .empty-board-hint {
            font-size: 0.9rem;
            opacity: 0.7;
        }

        /* Modal */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal {
            background: white;
            border-radius: 16px;
            padding: 2rem;
            max-width: 400px;
            width: 90%;
            box-shadow: var(--shadow-lg);
        }

        .modal-title {
            font-size: 1.25rem;
            font-weight: 800;
            margin-bottom: 1rem;
        }

        .modal-text {
            color: var(--text-muted);
            margin-bottom: 1.5rem;
        }

        .modal-actions {
            display: flex;
            gap: 0.5rem;
            justify-content: flex-end;
        }

        /* Toast Notifications */
        .toast-container {
            position: fixed;
            bottom: 1rem;
            right: 1rem;
            z-index: 1001;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .toast {
            background: var(--text-dark);
            color: white;
            padding: 1rem 1.5rem;
            border-radius: 8px;
            box-shadow: var(--shadow-lg);
            animation: slideIn 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .toast.success { background: var(--success-green); }
        .toast.error { background: #ef4444; }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* Additional column options */
        .board-container.cols-5 { grid-template-columns: repeat(5, 1fr); }
        .board-container.cols-6 { grid-template-columns: repeat(6, 1fr); }

        /* ================================================================
           MOBILE CASCADE OVERRIDES
           These MUST come AFTER global rules to win the CSS cascade.
           Global styles at lines ~1200+ otherwise override the earlier
           mobile media query rules due to same specificity + later source.
           ================================================================ */
        @media (max-width: 768px) {
            /* Hide table headers on mobile â€” card layout uses inline labels */
            .table-header,
            .table-header.boarding-header {
                display: none !important;
            }

            /* Ensure 4-column mobile card grid for ALL row types */
            .dog-row {
                grid-template-columns: 1fr 48px minmax(80px, 110px) 44px;
            }

            .dog-row.boarding {
                grid-template-columns: 1fr 48px minmax(80px, 110px) 44px;
            }

            /* Boarding crate: span columns 2-3 so text isn't truncated */
            .dog-row.boarding .crate-select {
                grid-column: 2 / 4;
                grid-row: 2;
                align-self: center;
                justify-self: stretch;
                width: auto;
                min-height: 44px;
                font-size: 16px;
                font-family: inherit;
                font-weight: 700;
                padding: 0.4rem 0.3rem;
                margin-top: 0.25rem;
                border-top: 2px solid var(--border-light);
                padding-top: 0.5rem;
                border-radius: 8px;
            }

            /* Boarding notes toggle: move to column 4 (shares with delete on row 1) */
            .dog-row.boarding .notes-toggle {
                grid-column: 4;
                grid-row: 2;
                justify-self: center;
                margin-top: 0.25rem;
                border-top: 2px solid var(--border-light);
                padding-top: 0.5rem;
            }

            /* Grooming mobile: 4-column card (Name across 1-3 | Delete in 4) */
            .dog-row.grooming {
                grid-template-columns: 1fr 1fr 70px 44px;
            }

            /* Boarding School mobile: 4-column card (Name across 1-3 | Delete in 4) */
            .dog-row.boarding-school {
                grid-template-columns: 1fr 1fr 80px 44px;
            }

            /* Grooming and Boarding School table headers hidden on mobile */
            .table-header.grooming-header,
            .table-header.boarding-school-header {
                display: none !important;
            }
        }

        /* Very small phones cascade fix */
        @media (max-width: 400px) {
            .dog-row {
                grid-template-columns: 1fr 44px minmax(70px, 90px) 40px;
            }

            .dog-row.boarding {
                grid-template-columns: 1fr 44px minmax(70px, 90px) 40px;
            }

            /* Grooming and Boarding School: same compact layout on very small phones */
            .dog-row.grooming {
                grid-template-columns: 1fr 1fr 60px 40px;
            }

            .dog-row.boarding-school {
                grid-template-columns: 1fr 1fr 70px 40px;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-left">
            <img src="https://i.ibb.co/whdBKp0L/Logo-1.jpg" alt="Fairy Tails" class="logo">
            <div>
                <div class="header-title">Staff Board</div>
                <div class="header-subtitle">Fairy Tails K9 Centre</div>
            </div>
        </div>
        <div class="header-right">
            <div class="current-time" id="currentTime">--:--</div>
            <button class="btn refresh-btn" onclick="manualRefresh()" title="Refresh from Google Sheets">
                ðŸ”„
            </button>
        </div>
    </header>

    <!-- Tab Navigation -->
    <nav class="tab-nav">
        <button class="tab-btn active" data-tab="today" onclick="switchTab('today')">
            ðŸ“… TODAY
        </button>
        <button class="tab-btn" data-tab="tomorrow" onclick="switchTab('tomorrow')">
            ðŸ“† TOMORROW
        </button>
        <div class="tab-actions">
            <button class="btn btn-success" onclick="transferToToday()">
                â¬…ï¸ Transfer Tomorrow â†’ Today
            </button>
            <button class="btn btn-primary" onclick="saveBoard()">
                ðŸ’¾ Save
            </button>
        </div>
    </nav>

    <!-- Today Tab -->
    <div class="tab-content active" id="today-tab">
        <!-- Staging Area -->
        <div class="staging-area">
            <div class="staging-header">
                <div class="staging-title">
                    ðŸ• Add Dogs
                    <span class="staging-count" id="today-staging-count">0</span>
                </div>
                <div>
                    <button class="btn btn-outline btn-small" onclick="clearStaging('today')">Clear Staging</button>
                </div>
            </div>
            <div class="staging-input-row">
                <input type="text" class="staging-input" id="today-staging-input" 
                       placeholder="Type dog name and press Enter..." 
                       onkeypress="handleStagingKeypress(event, 'today')">
                <select class="service-type-select" id="today-service-type">
                    <option value="Full Day">â˜€ï¸ Full Day</option>
                    <option value="Half Day AM">ðŸŒ… Half Day</option>
                    <option value="Boarding">ðŸ  Boarding</option>
                    <option value="Grooming">âœ‚ï¸ Grooming Dogs</option>
                    <option value="Boarding School">ðŸŽ“ Boarding School</option>
                </select>
                <button class="btn btn-primary" onclick="addToStaging('today')">+ Add</button>
            </div>
            <div class="staging-dogs" id="today-staging-dogs"></div>
            <div class="staging-actions">
                <button class="btn btn-success" onclick="addStagedToBoard('today')">
                    âœ… Add to Board
                </button>
            </div>
        </div>

        <!-- Stats Bar -->
        <div class="stats-bar">
            <div class="stat-card">
                <div class="stat-icon dogs">ðŸ•</div>
                <div>
                    <div class="stat-value" id="today-dog-count">0</div>
                    <div class="stat-label">Dogs Today</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon photos">ðŸ“¸</div>
                <div>
                    <div class="stat-value" id="today-photo-count">0</div>
                    <div class="stat-label">Photos Done</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon walks">ðŸš¶</div>
                <div>
                    <div class="stat-value" id="today-walk-count">0</div>
                    <div class="stat-label">Walks Booked</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon vans">ðŸš</div>
                <div>
                    <div class="stat-value" id="today-van-count">0</div>
                    <div class="stat-label">Van Pickups</div>
                </div>
            </div>
        </div>

        <!-- Van Legend -->
        <div class="van-legend">
            <div class="van-item">
                <span class="van-badge bv">BV</span>
                <span>Big Van</span>
                <select class="van-time-select" id="today-bv-time" onchange="updateVanTime('today', 'BV', this.value)">
                </select>
            </div>
            <div class="van-item">
                <span class="van-badge dv">DV</span>
                <span>Dispatch Van</span>
                <select class="van-time-select" id="today-dv-time" onchange="updateVanTime('today', 'DV', this.value)">
                </select>
            </div>
            <div class="van-item">
                <span class="van-badge sv">SV</span>
                <span>Small Van</span>
                <select class="van-time-select" id="today-sv-time" onchange="updateVanTime('today', 'SV', this.value)">
                </select>
            </div>
            <div class="van-item" style="margin-left: auto;">
                <span style="color: var(--warning-amber);">WalkðŸ“† = Booked</span>
                <span style="color: var(--success-green); margin-left: 1rem;">Walkâœ… = On Walking Board</span>
            </div>
        </div>

        <!-- Board -->
        <div class="board-container cols-1" id="today-board">
            <div class="empty-board">
                <div class="empty-board-icon">ðŸ¾</div>
                <div class="empty-board-text">No dogs on the board yet</div>
                <div class="empty-board-hint">Add dogs using the staging area above</div>
            </div>
        </div>
    </div>

    <!-- Tomorrow Tab -->
    <div class="tab-content" id="tomorrow-tab">
        <!-- Staging Area -->
        <div class="staging-area">
            <div class="staging-header">
                <div class="staging-title">
                    ðŸ• Add Dogs
                    <span class="staging-count" id="tomorrow-staging-count">0</span>
                </div>
                <div>
                    <button class="btn btn-outline btn-small" onclick="clearStaging('tomorrow')">Clear Staging</button>
                </div>
            </div>
            <div class="staging-input-row">
                <input type="text" class="staging-input" id="tomorrow-staging-input" 
                       placeholder="Type dog name and press Enter..." 
                       onkeypress="handleStagingKeypress(event, 'tomorrow')">
                <select class="service-type-select" id="tomorrow-service-type">
                    <option value="Full Day">â˜€ï¸ Full Day</option>
                    <option value="Half Day AM">ðŸŒ… Half Day</option>
                    <option value="Boarding">ðŸ  Boarding</option>
                    <option value="Grooming">âœ‚ï¸ Grooming Dogs</option>
                    <option value="Boarding School">ðŸŽ“ Boarding School</option>
                </select>
                <button class="btn btn-primary" onclick="addToStaging('tomorrow')">+ Add</button>
            </div>
            <div class="staging-dogs" id="tomorrow-staging-dogs"></div>
            <div class="staging-actions">
                <button class="btn btn-success" onclick="addStagedToBoard('tomorrow')">
                    âœ… Add to Board
                </button>
            </div>
        </div>

        <!-- Stats Bar -->
        <div class="stats-bar">
            <div class="stat-card">
                <div class="stat-icon dogs">ðŸ•</div>
                <div>
                    <div class="stat-value" id="tomorrow-dog-count">0</div>
                    <div class="stat-label">Dogs Tomorrow</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon walks">ðŸš¶</div>
                <div>
                    <div class="stat-value" id="tomorrow-walk-count">0</div>
                    <div class="stat-label">Walks Booked</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon vans">ðŸš</div>
                <div>
                    <div class="stat-value" id="tomorrow-van-count">0</div>
                    <div class="stat-label">Van Pickups</div>
                </div>
            </div>
        </div>

        <!-- Van Legend -->
        <div class="van-legend">
            <div class="van-item">
                <span class="van-badge bv">BV</span>
                <span>Big Van</span>
                <select class="van-time-select" id="tomorrow-bv-time" onchange="updateVanTime('tomorrow', 'BV', this.value)">
                </select>
            </div>
            <div class="van-item">
                <span class="van-badge dv">DV</span>
                <span>Dispatch Van</span>
                <select class="van-time-select" id="tomorrow-dv-time" onchange="updateVanTime('tomorrow', 'DV', this.value)">
                </select>
            </div>
            <div class="van-item">
                <span class="van-badge sv">SV</span>
                <span>Small Van</span>
                <select class="van-time-select" id="tomorrow-sv-time" onchange="updateVanTime('tomorrow', 'SV', this.value)">
                </select>
            </div>
        </div>

        <!-- Board -->
        <div class="board-container cols-1" id="tomorrow-board">
            <div class="empty-board">
                <div class="empty-board-icon">ðŸ¾</div>
                <div class="empty-board-text">No dogs on the board yet</div>
                <div class="empty-board-hint">Add dogs using the staging area above</div>
            </div>
        </div>
    </div>

    <!-- Transfer Confirmation Modal -->
    <div class="modal-overlay" id="transferModal">
        <div class="modal">
            <div class="modal-title">âš ï¸ Transfer Tomorrow to Today?</div>
            <div class="modal-text">
                This will replace all of Today's data with Tomorrow's data, and clear Tomorrow's board. This action cannot be undone.
            </div>
            <div class="modal-actions">
                <button class="btn btn-outline" onclick="closeModal()">Cancel</button>
                <button class="btn btn-danger" onclick="confirmTransfer()">Yes, Transfer</button>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <script>
        // =====================
        // Configuration
        // =====================
        const CONFIG = {
            SCRIPT_URL: 'https://script.google.com/macros/s/AKfycbzqXD9OCM5oSNFdy3OF7pOG0PRcpy4dgkEYWJBVh40CFHJgjvSpPn6SE-mNjloo-GKw/exec',
            USE_GOOGLE_SHEETS: true,  // Set to false to use localStorage only
            MAX_ROWS_PER_COLUMN: 15
        };

        // =====================
        // State Management
        // =====================
        let state = {
            today: { 
                dogs: [], 
                staging: [],
                vanTimes: { BV: '07:30', DV: '08:00', SV: '08:30' }
            },
            tomorrow: { 
                dogs: [], 
                staging: [],
                vanTimes: { BV: '07:30', DV: '08:00', SV: '08:30' }
            },
            currentTab: 'today',
            initialLoadComplete: false  // Prevents autoSave until data is loaded
        };

        // =====================
        // Time Options Generator
        // =====================
        function generateTimeOptions() {
            const options = [];
            for (let hour = 0; hour < 24; hour++) {
                for (let minute = 0; minute < 60; minute += 15) {
                    const h = hour.toString().padStart(2, '0');
                    const m = minute.toString().padStart(2, '0');
                    options.push(`${h}:${m}`);
                }
            }
            return options;
        }

        function populateVanTimeDropdowns() {
            const timeOptions = generateTimeOptions();
            const optionsHTML = timeOptions.map(t => `<option value="${t}">${t}</option>`).join('');
            
            // Populate all van time selects
            ['today', 'tomorrow'].forEach(tab => {
                ['bv', 'dv', 'sv'].forEach(van => {
                    const select = document.getElementById(`${tab}-${van}-time`);
                    if (select) {
                        select.innerHTML = optionsHTML;
                        select.value = state[tab].vanTimes[van.toUpperCase()] || '08:00';
                    }
                });
            });
        }

        function updateVanTime(tab, van, time) {
            state[tab].vanTimes[van] = time;
            autoSave();
        }

        // =====================
        // Utility Functions
        // =====================
        function generateId() {
            return 'dog_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        }

        function showToast(message, type = 'info') {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerHTML = `<span>${message}</span>`;
            container.appendChild(toast);
            setTimeout(() => toast.remove(), 3000);
        }

        function updateTime() {
            const now = new Date();
            document.getElementById('currentTime').textContent = 
                now.toLocaleTimeString('en-GB', { hour: '2-digit', minute: '2-digit' });
        }

        // =====================
        // Tab Management
        // =====================
        function switchTab(tab) {
            state.currentTab = tab;
            
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.tab === tab);
            });
            
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(`${tab}-tab`).classList.add('active');
        }

        // =====================
        // Staging Area
        // =====================
        function handleStagingKeypress(event, tab) {
            if (event.key === 'Enter') {
                addToStaging(tab);
            }
        }

        function addToStaging(tab) {
            const input = document.getElementById(`${tab}-staging-input`);
            const name = input.value.trim();
            
            if (!name) return;
            
            state[tab].staging.push(name);
            input.value = '';
            input.focus();
            
            renderStaging(tab);
        }

        function removeFromStaging(tab, index) {
            state[tab].staging.splice(index, 1);
            renderStaging(tab);
        }

        function clearStaging(tab) {
            state[tab].staging = [];
            renderStaging(tab);
        }

        function renderStaging(tab) {
            const container = document.getElementById(`${tab}-staging-dogs`);
            const countEl = document.getElementById(`${tab}-staging-count`);
            const staging = state[tab].staging;
            
            countEl.textContent = staging.length;
            
            if (staging.length === 0) {
                container.innerHTML = '';
                return;
            }
            
            container.innerHTML = staging.map((name, index) => `
                <div class="staged-dog">
                    <span>${name}</span>
                    <button class="staged-dog-remove" onclick="removeFromStaging('${tab}', ${index})">Ã—</button>
                </div>
            `).join('');
        }

        function addStagedToBoard(tab) {
            const staging = state[tab].staging;
            
            if (staging.length === 0) {
                showToast('No dogs to add â€” enter some names first', 'error');
                return;
            }
            
            // Get selected service type
            const serviceTypeSelect = document.getElementById(`${tab}-service-type`);
            const serviceType = serviceTypeSelect ? serviceTypeSelect.value : 'Full Day';
            
            // Create dog objects from staged names with selected service type
            const newDogs = staging.map(name => {
                // Base dog object with all fields
                const dog = {
                    id: generateId(),
                    name: name,
                    photo: false,
                    walk: '',
                    vpAM: '',
                    vpPM: '',
                    stopAM: '',
                    stop: '',
                    notes: '',
                    crate: '',
                    serviceType: serviceType,
                    // Grooming Dogs fields
                    pickup: '',
                    dropoff: '',
                    vanType: '',
                    // Boarding School fields
                    checkIn: '',
                    checkOut: '',
                    crateSize: ''
                };
                return dog;
            });
            
            // Add to existing dogs
            state[tab].dogs = [...state[tab].dogs, ...newDogs];
            
            // Clear staging
            state[tab].staging = [];
            renderStaging(tab);
            
            // Re-render board
            renderBoard(tab);
            
            // Auto-save
            autoSave();
            
            showToast(`âœ… Added ${newDogs.length} dog${newDogs.length > 1 ? 's' : ''} to ${serviceType}`, 'success');
        }

        // =====================
        // Layout Algorithm
        // =====================
        function calculateLayout(dogCount) {
            if (dogCount === 0) return { columns: 1, rowsPerColumn: 0, scale: '' };
            
            // Comfortable editing layout with scrolling allowed
            if (dogCount <= 12) {
                return { columns: 1, rowsPerColumn: dogCount, scale: '' };
            }
            if (dogCount <= 24) {
                return { columns: 2, rowsPerColumn: Math.ceil(dogCount / 2), scale: '' };
            }
            if (dogCount <= 45) {
                return { columns: 3, rowsPerColumn: Math.ceil(dogCount / 3), scale: '' };
            }
            
            // For larger numbers, use 4 columns
            return { columns: 4, rowsPerColumn: Math.ceil(dogCount / 4), scale: '' };
        }

        // Recalculate layout on window resize
        let resizeTimeout;
        window.addEventListener('resize', () => {
            clearTimeout(resizeTimeout);
            resizeTimeout = setTimeout(() => {
                renderBoard('today');
                renderBoard('tomorrow');
            }, 250);
        });

        // =====================
        // Board Rendering
        // =====================
        function createDogRow(dog, sectionClass = '') {
            const { id, name, photo, walk, vpAM, vpPM, stopAM, stop, notes } = dog;
            
            // Determine styling classes for VP selects
            const getVPClass = (val) => {
                if (val === 'V' || val === 'BV') return 'van-bv';
                if (val === 'SV') return 'van-sv';
                if (val === 'DV') return 'van-dv';
                if (val === 'P') return 'parent-pickup';
                return '';
            };
            
            const vpAMClass = getVPClass(vpAM);
            const vpPMClass = getVPClass(vpPM);
            
            // Disable stop selects based on van/parent selection
            const vanOptions = ['V', 'BV', 'SV', 'DV'];
            const stopAMDisabled = !vanOptions.includes(vpAM);
            const stopPMDisabled = !vanOptions.includes(vpPM);
            
            // Generate stop number options (1-20)
            const generateStopOptions = (selectedValue) => {
                let options = '<option value="">-</option>';
                for (let i = 1; i <= 20; i++) {
                    const selected = String(selectedValue) === String(i) ? 'selected' : '';
                    options += `<option value="${i}" ${selected}>${i}</option>`;
                }
                return options;
            };

            return `
                <div class="dog-row section-row ${sectionClass} ${notes ? 'notes-expanded' : ''}" data-id="${id}">
                    <div class="dog-name">${name}</div>
                    
                    <div class="photo-check">
                        <input type="checkbox" class="photo-checkbox" 
                               ${photo ? 'checked' : ''} 
                               onchange="updateDog('${id}', 'photo', this.checked)">
                    </div>
                    
                    <select class="walk-select ${walk === 'booked' ? 'walk-booked' : walk === 'transferred' ? 'walk-transferred' : ''}" 
                            onchange="updateDog('${id}', 'walk', this.value); updateWalkStyle(this)">
                        <option value="">None</option>
                        <option value="booked" ${walk === 'booked' ? 'selected' : ''}>WalkðŸ“†</option>
                        <option value="transferred" ${walk === 'transferred' ? 'selected' : ''}>Walkâœ…</option>
                    </select>
                    
                    <div class="vp-control">
                        <select class="stop-select stop-am ${stopAM ? 'has-value' : ''}" 
                               ${stopAMDisabled ? 'disabled' : ''}
                               onchange="updateDog('${id}', 'stopAM', this.value); updateStopStyle(this)"
                               title="AM Stop Number">
                            ${generateStopOptions(stopAM)}
                        </select>
                        <select class="vp-select vp-am ${vpAMClass}" 
                                onchange="updateDog('${id}', 'vpAM', this.value); updateVPStyle(this)"
                                title="Morning pickup">
                            <option value="">-</option>
                            <option value="V" ${vpAM === 'V' ? 'selected' : ''}>V</option>
                            <option value="P" ${vpAM === 'P' ? 'selected' : ''}>P</option>
                            <option value="BV" ${vpAM === 'BV' ? 'selected' : ''}>BV</option>
                            <option value="SV" ${vpAM === 'SV' ? 'selected' : ''}>SV</option>
                            <option value="DV" ${vpAM === 'DV' ? 'selected' : ''}>DV</option>
                        </select>
                        <select class="vp-select vp-pm ${vpPMClass}" 
                                onchange="updateDog('${id}', 'vpPM', this.value); updateVPStyle(this)"
                                title="Evening dropoff">
                            <option value="">-</option>
                            <option value="V" ${vpPM === 'V' ? 'selected' : ''}>V</option>
                            <option value="P" ${vpPM === 'P' ? 'selected' : ''}>P</option>
                            <option value="BV" ${vpPM === 'BV' ? 'selected' : ''}>BV</option>
                            <option value="SV" ${vpPM === 'SV' ? 'selected' : ''}>SV</option>
                            <option value="DV" ${vpPM === 'DV' ? 'selected' : ''}>DV</option>
                        </select>
                        <select class="stop-select stop-pm ${stop ? 'has-value' : ''}" 
                               ${stopPMDisabled ? 'disabled' : ''}
                               onchange="updateDog('${id}', 'stop', this.value); updateStopStyle(this)"
                               title="PM Stop Number">
                            ${generateStopOptions(stop)}
                        </select>
                    </div>
                    
                    <div class="notes-toggle ${notes ? 'has-notes' : ''}" onclick="toggleNotes(this)" title="Toggle notes">
                        <span class="notes-toggle-label">ðŸ“</span>
                        <div class="toggle-track"><div class="toggle-knob"></div></div>
                    </div>
                    
                    <input type="text" class="notes-input" placeholder="Notes..." 
                           value="${notes || ''}" 
                           onchange="updateDog('${id}', 'notes', this.value); updateNotesToggle(this)"
                           oninput="updateNotesToggle(this)">
                    
                    <button class="delete-btn" onclick="deleteDog('${id}')" title="Remove dog">Ã—</button>
                </div>
            `;
        }

        // Boarding-specific row: AM only + Crate select
        function createBoardingDogRow(dog) {
            const { id, name, photo, walk, vpAM, stopAM, notes, crate } = dog;
            
            const getVPClass = (val) => {
                if (val === 'V' || val === 'BV') return 'van-bv';
                if (val === 'SV') return 'van-sv';
                if (val === 'DV') return 'van-dv';
                if (val === 'P') return 'parent-pickup';
                return '';
            };
            
            const vpAMClass = getVPClass(vpAM);
            const vanOptions = ['V', 'BV', 'SV', 'DV'];
            const stopAMDisabled = !vanOptions.includes(vpAM);
            
            const generateStopOptions = (selectedValue) => {
                let options = '<option value="">-</option>';
                for (let i = 1; i <= 20; i++) {
                    const selected = String(selectedValue) === String(i) ? 'selected' : '';
                    options += `<option value="${i}" ${selected}>${i}</option>`;
                }
                return options;
            };
            
            const crateOptions = ['HLL', 'HLM', 'HLU', 'HLS', 'HSM', 'HSS'];

            return `
                <div class="dog-row section-row boarding ${notes ? 'notes-expanded' : ''}" data-id="${id}">
                    <div class="dog-name">${name}</div>
                    
                    <div class="photo-check">
                        <input type="checkbox" class="photo-checkbox" 
                               ${photo ? 'checked' : ''} 
                               onchange="updateDog('${id}', 'photo', this.checked)">
                    </div>
                    
                    <select class="walk-select ${walk === 'booked' ? 'walk-booked' : walk === 'transferred' ? 'walk-transferred' : ''}" 
                            onchange="updateDog('${id}', 'walk', this.value); updateWalkStyle(this)">
                        <option value="">None</option>
                        <option value="booked" ${walk === 'booked' ? 'selected' : ''}>WalkðŸ“†</option>
                        <option value="transferred" ${walk === 'transferred' ? 'selected' : ''}>Walkâœ…</option>
                    </select>
                    
                    <div class="vp-control-am">
                        <select class="stop-select stop-am ${stopAM ? 'has-value' : ''}" 
                               ${stopAMDisabled ? 'disabled' : ''}
                               onchange="updateDog('${id}', 'stopAM', this.value); updateStopStyle(this)"
                               title="AM Stop Number">
                            ${generateStopOptions(stopAM)}
                        </select>
                        <select class="vp-select vp-am ${vpAMClass}" 
                                onchange="updateDog('${id}', 'vpAM', this.value); updateVPStyle(this)"
                                title="AM pickup">
                            <option value="">-</option>
                            <option value="V" ${vpAM === 'V' ? 'selected' : ''}>V</option>
                            <option value="P" ${vpAM === 'P' ? 'selected' : ''}>P</option>
                            <option value="BV" ${vpAM === 'BV' ? 'selected' : ''}>BV</option>
                            <option value="SV" ${vpAM === 'SV' ? 'selected' : ''}>SV</option>
                            <option value="DV" ${vpAM === 'DV' ? 'selected' : ''}>DV</option>
                        </select>
                    </div>
                    
                    <select class="crate-select ${crate ? 'has-value' : ''}" 
                            onchange="updateDog('${id}', 'crate', this.value); this.classList.toggle('has-value', !!this.value)"
                            title="Crate type">
                        <option value="">-</option>
                        ${crateOptions.map(c => `<option value="${c}" ${crate === c ? 'selected' : ''}>${c}</option>`).join('')}
                    </select>
                    
                    <div class="notes-toggle ${notes ? 'has-notes' : ''}" onclick="toggleNotes(this)" title="Toggle notes">
                        <span class="notes-toggle-label">ðŸ“</span>
                        <div class="toggle-track"><div class="toggle-knob"></div></div>
                    </div>
                    
                    <input type="text" class="notes-input" placeholder="Notes..." 
                           value="${notes || ''}" 
                           onchange="updateDog('${id}', 'notes', this.value); updateNotesToggle(this)"
                           oninput="updateNotesToggle(this)">
                    
                    <button class="delete-btn" onclick="deleteDog('${id}')" title="Remove dog">Ã—</button>
                </div>
            `;
        }

        // Grooming Dogs row: Name | Pick Up | Drop Off | Van Type | Delete
        function createGroomingDogRow(dog) {
            const { id, name, pickup, dropoff, vanType } = dog;

            const pickupOptions = ['AM Pick Up', 'AM Drop Off', 'PM Pick Up', 'PM Drop Off'];
            const dropoffOptions = ['AM Pick Up', 'AM Drop Off', 'PM Pick Up', 'PM Drop Off'];
            const vanTypeOptions = ['BV', 'SV', 'DV'];

            return `
                <div class="dog-row section-row grooming" data-id="${id}">
                    <div class="dog-name">${name}</div>
                    
                    <select class="grooming-select grooming-pickup ${pickup ? 'has-value' : ''}" 
                            onchange="updateDog('${id}', 'pickup', this.value); this.classList.toggle('has-value', !!this.value)"
                            title="Pick Up">
                        <option value="">Pick Up...</option>
                        ${pickupOptions.map(opt => `<option value="${opt}" ${pickup === opt ? 'selected' : ''}>${opt}</option>`).join('')}
                    </select>
                    
                    <select class="grooming-select grooming-dropoff ${dropoff ? 'has-value' : ''}" 
                            onchange="updateDog('${id}', 'dropoff', this.value); this.classList.toggle('has-value', !!this.value)"
                            title="Drop Off">
                        <option value="">Drop Off...</option>
                        ${dropoffOptions.map(opt => `<option value="${opt}" ${dropoff === opt ? 'selected' : ''}>${opt}</option>`).join('')}
                    </select>
                    
                    <select class="grooming-van-select ${vanType ? 'has-value' : ''}" 
                            onchange="updateDog('${id}', 'vanType', this.value); this.classList.toggle('has-value', !!this.value)"
                            title="Van Type">
                        <option value="">Van...</option>
                        ${vanTypeOptions.map(opt => `<option value="${opt}" ${vanType === opt ? 'selected' : ''}>${opt}</option>`).join('')}
                    </select>
                    
                    <button class="delete-btn" onclick="deleteDog('${id}')" title="Remove dog">Ã—</button>
                </div>
            `;
        }

        // Boarding School row: Name | Check In | Check Out | Crate Size | Delete
        function createBoardingSchoolDogRow(dog) {
            const { id, name, checkIn, checkOut, crateSize } = dog;

            const crateSizeOptions = ['HLL', 'HLM', 'HLS', 'HSB', 'HST'];

            return `
                <div class="dog-row section-row boarding-school" data-id="${id}">
                    <div class="dog-name">${name}</div>
                    
                    <input type="date" class="bs-date-input bs-checkin ${checkIn ? 'has-value' : ''}" 
                           value="${checkIn || ''}"
                           onchange="updateDog('${id}', 'checkIn', this.value); this.classList.toggle('has-value', !!this.value)"
                           title="Check In Date">
                    
                    <input type="date" class="bs-date-input bs-checkout ${checkOut ? 'has-value' : ''}" 
                           value="${checkOut || ''}"
                           onchange="updateDog('${id}', 'checkOut', this.value); this.classList.toggle('has-value', !!this.value)"
                           title="Check Out Date">
                    
                    <select class="bs-crate-select ${crateSize ? 'has-value' : ''}" 
                            onchange="updateDog('${id}', 'crateSize', this.value); this.classList.toggle('has-value', !!this.value)"
                            title="Crate Size">
                        <option value="">Crate...</option>
                        ${crateSizeOptions.map(opt => `<option value="${opt}" ${crateSize === opt ? 'selected' : ''}>${opt}</option>`).join('')}
                    </select>
                    
                    <button class="delete-btn" onclick="deleteDog('${id}')" title="Remove dog">Ã—</button>
                </div>
            `;
        }

        function renderBoard(tab) {
            const board = document.getElementById(`${tab}-board`);
            const dogs = state[tab].dogs;
            
            // Empty state
            if (dogs.length === 0) {
                board.className = 'board-container cols-1';
                board.innerHTML = `
                    <div class="empty-board">
                        <div class="empty-board-icon">ðŸ¾</div>
                        <div class="empty-board-text">No dogs on the board yet</div>
                        <div class="empty-board-hint">Add dogs using the staging area above</div>
                    </div>
                `;
                updateStats(tab);
                return;
            }
            
            // Group dogs by service type
            const serviceGroups = {
                'Half Day AM': [],
                'Full Day': [],
                'Boarding': [],
                'Grooming': [],
                'Boarding School': []
            };
            
            dogs.forEach(dog => {
                const type = dog.serviceType || 'Full Day';
                if (type === 'Grooming') {
                    serviceGroups['Grooming'].push(dog);
                } else if (type === 'Boarding School') {
                    serviceGroups['Boarding School'].push(dog);
                } else if (type.includes('Half Day')) {
                    serviceGroups['Half Day AM'].push(dog);
                } else if (type.includes('Boarding')) {
                    serviceGroups['Boarding'].push(dog);
                } else {
                    serviceGroups['Full Day'].push(dog);
                }
            });
            
            // Service type configuration
            const serviceConfig = {
                'Half Day AM': { 
                    icon: 'ðŸŒ…', 
                    label: 'Half Day (Leave ~12pm)', 
                    class: 'half-day-am',
                    order: 1
                },
                'Full Day': { 
                    icon: 'â˜€ï¸', 
                    label: 'Full Day (Leave ~5pm)', 
                    class: 'full-day',
                    order: 2
                },
                'Boarding': { 
                    icon: 'ðŸ ', 
                    label: 'Boarding', 
                    class: 'boarding',
                    order: 3
                },
                'Grooming': { 
                    icon: 'âœ‚ï¸', 
                    label: 'Grooming Dogs', 
                    class: 'grooming',
                    order: 4
                },
                'Boarding School': { 
                    icon: 'ðŸŽ“', 
                    label: 'Boarding School', 
                    class: 'boarding-school',
                    order: 5
                }
            };
            
            // Calculate layout
            const layout = calculateLayout(dogs.length);
            
            // Apply column count and scale classes
            let classNames = `board-container cols-1`; // Sections are full width
            if (layout.scale) {
                classNames += ` ${layout.scale}`;
            }
            board.className = classNames;
            
            // Build HTML for each section
            let html = '';
            
            // Render sections in order: Half Day AM first, then Full Day, then Boarding
            const orderedTypes = Object.keys(serviceGroups).sort((a, b) => 
                serviceConfig[a].order - serviceConfig[b].order
            );
            
            for (const serviceType of orderedTypes) {
                const sectionDogs = serviceGroups[serviceType];
                if (sectionDogs.length === 0) continue;
                
                const config = serviceConfig[serviceType];
                const isBoarding = serviceType === 'Boarding';
                const isGrooming = serviceType === 'Grooming';
                const isBoardingSchool = serviceType === 'Boarding School';
                
                // Each section type gets its own header and row layout
                let tableHeaderClass, headerCols, rowsHtml;
                
                if (isGrooming) {
                    tableHeaderClass = 'table-header grooming-header';
                    headerCols = `<span>Name</span><span>Pick Up</span><span>Drop Off</span><span>Van Type</span><span></span>`;
                    rowsHtml = sectionDogs.map(dog => createGroomingDogRow(dog)).join('');
                } else if (isBoardingSchool) {
                    tableHeaderClass = 'table-header boarding-school-header';
                    headerCols = `<span>Name</span><span>Check In</span><span>Check Out</span><span>Crate Size</span><span></span>`;
                    rowsHtml = sectionDogs.map(dog => createBoardingSchoolDogRow(dog)).join('');
                } else if (isBoarding) {
                    tableHeaderClass = 'table-header boarding-header';
                    headerCols = `<span>Name</span><span>Photo</span><span>Walk</span><span>AM</span><span>Crate</span><span>Notes</span><span></span>`;
                    rowsHtml = sectionDogs.map(dog => createBoardingDogRow(dog)).join('');
                } else {
                    tableHeaderClass = 'table-header';
                    headerCols = `<span>Name</span><span>Photo</span><span>Walk</span><span>AM/PM</span><span>Notes</span><span></span>`;
                    rowsHtml = sectionDogs.map(dog => createDogRow(dog, config.class)).join('');
                }
                
                html += `
                    <div class="service-section">
                        <div class="section-header ${config.class}">
                            <span><span class="section-icon">${config.icon}</span>${config.label}</span>
                            <span class="section-count">${sectionDogs.length} dog${sectionDogs.length !== 1 ? 's' : ''}</span>
                        </div>
                        <div class="section-content">
                            <div class="${tableHeaderClass}">
                                ${headerCols}
                            </div>
                            <div class="dog-rows">
                                ${rowsHtml}
                            </div>
                        </div>
                    </div>
                `;
            }

            board.innerHTML = html;
            updateStats(tab);
        }

        function updateStats(tab) {
            const dogs = state[tab].dogs;
            
            document.getElementById(`${tab}-dog-count`).textContent = dogs.length;
            
            if (tab === 'today') {
                document.getElementById(`${tab}-photo-count`).textContent = 
                    dogs.filter(d => d.photo).length;
            }
            
            document.getElementById(`${tab}-walk-count`).textContent = 
                dogs.filter(d => d.walk).length;
            
            // Count dogs with any van option (V, BV, SV, or DV) in AM or PM
            const vanOptions = ['V', 'BV', 'SV', 'DV'];
            document.getElementById(`${tab}-van-count`).textContent = 
                dogs.filter(d => vanOptions.includes(d.vpAM) || vanOptions.includes(d.vpPM)).length;
        }

        // =====================
        // Dog Management
        // =====================
        function updateDog(id, field, value) {
            const tab = state.currentTab;
            const dog = state[tab].dogs.find(d => d.id === id);
            if (dog) {
                dog[field] = value;
                updateStats(tab);
                autoSave(); // Save changes immediately
            }
        }

        // Toggle notes row visibility on mobile
        function toggleNotes(toggleEl) {
            const row = toggleEl.closest('.dog-row');
            row.classList.toggle('notes-expanded');
            
            // If expanding, focus the input for immediate typing
            if (row.classList.contains('notes-expanded')) {
                const input = row.querySelector('.notes-input');
                setTimeout(() => input.focus(), 280);
            }
        }
        
        // Sync the has-notes indicator when notes content changes
        function updateNotesToggle(input) {
            const row = input.closest('.dog-row');
            const toggle = row.querySelector('.notes-toggle');
            if (toggle) {
                if (input.value.trim()) {
                    toggle.classList.add('has-notes');
                } else {
                    toggle.classList.remove('has-notes');
                }
            }
        }

        function updateWalkStyle(select) {
            select.classList.remove('walk-booked', 'walk-transferred');
            if (select.value === 'booked') select.classList.add('walk-booked');
            if (select.value === 'transferred') select.classList.add('walk-transferred');
        }

        function updateVPStyle(select) {
            const row = select.closest('.dog-row');
            const stopAMSelect = row.querySelector('.stop-am');
            const stopPMSelect = row.querySelector('.stop-pm');
            const vpAMSelect = row.querySelector('.vp-am');
            const vpPMSelect = row.querySelector('.vp-pm');
            
            // Update class for styling - remove all, add appropriate
            select.classList.remove('van-pickup', 'van-bv', 'van-sv', 'van-dv', 'parent-pickup');
            if (select.value === 'V' || select.value === 'BV') select.classList.add('van-bv');
            if (select.value === 'SV') select.classList.add('van-sv');
            if (select.value === 'DV') select.classList.add('van-dv');
            if (select.value === 'P') select.classList.add('parent-pickup');
            
            // Van options that enable stop selects
            const vanOptions = ['V', 'BV', 'SV', 'DV'];
            
            // Enable/disable AM stop select based on AM selection
            if (vpAMSelect && stopAMSelect) {
                const isAMVan = vanOptions.includes(vpAMSelect.value);
                stopAMSelect.disabled = !isAMVan;
                if (!isAMVan) {
                    stopAMSelect.value = '';
                    stopAMSelect.classList.remove('has-value');
                    const id = row.dataset.id;
                    updateDog(id, 'stopAM', '');
                }
            }
            
            // Enable/disable PM stop select based on PM selection (not present on boarding rows)
            if (vpPMSelect && stopPMSelect) {
                const isPMVan = vanOptions.includes(vpPMSelect.value);
                stopPMSelect.disabled = !isPMVan;
                if (!isPMVan) {
                    stopPMSelect.value = '';
                    stopPMSelect.classList.remove('has-value');
                    const id = row.dataset.id;
                    updateDog(id, 'stop', '');
                }
            }
        }

        function updateStopStyle(select) {
            // Toggle has-value class based on selection
            if (select.value) {
                select.classList.add('has-value');
            } else {
                select.classList.remove('has-value');
            }
        }

        function deleteDog(id) {
            const tab = state.currentTab;
            const dog = state[tab].dogs.find(d => d.id === id);
            const dogName = dog ? dog.name : 'Dog';
            
            state[tab].dogs = state[tab].dogs.filter(d => d.id !== id);
            renderBoard(tab);
            autoSave();
            showToast(`ðŸ—‘ï¸ ${dogName} removed from board`, 'info');
        }

        // =====================
        // Transfer & Clear
        // =====================
        function transferToToday() {
            if (state.tomorrow.dogs.length === 0) {
                showToast('Tomorrow\'s board is empty â€” nothing to transfer', 'error');
                return;
            }
            document.getElementById('transferModal').classList.add('active');
        }

        async function confirmTransfer() {
            // Try to use Google Sheets transfer endpoint
            if (CONFIG.USE_GOOGLE_SHEETS && CONFIG.SCRIPT_URL) {
                try {
                    const response = await fetch(CONFIG.SCRIPT_URL, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ action: 'transfer' })
                    });
                    
                    const result = await response.json();
                    
                    if (result.success) {
                        // Reload data from server
                        await loadBoard();
                        closeModal();
                        showToast(`âœ… Transferred ${result.transferred} dogs to Today!`, 'success');
                        switchTab('today');
                        return;
                    }
                } catch (error) {
                    console.error('Failed to transfer via Google Sheets:', error);
                    // Fall through to local transfer
                }
            }
            
            // Local transfer fallback
            state.today.dogs = JSON.parse(JSON.stringify(state.tomorrow.dogs));
            state.today.vanTimes = JSON.parse(JSON.stringify(state.tomorrow.vanTimes));
            
            // Reset photo status and notes for today (fresh day)
            state.today.dogs.forEach(dog => {
                dog.photo = false;
                dog.notes = '';
                if (dog.walk === 'transferred') {
                    dog.walk = 'booked';
                }
            });
            
            // Clear tomorrow
            state.tomorrow.dogs = [];
            state.tomorrow.staging = [];
            state.tomorrow.vanTimes = { BV: '07:30', DV: '08:00', SV: '08:30' };
            
            // Re-render
            populateVanTimeDropdowns();
            renderBoard('today');
            renderBoard('tomorrow');
            renderStaging('tomorrow');
            
            closeModal();
            showToast('âœ… Tomorrow transferred to Today successfully!', 'success');
            
            // Switch to Today tab
            switchTab('today');
            
            saveBoard();
        }

        function closeModal() {
            document.querySelectorAll('.modal-overlay').forEach(m => m.classList.remove('active'));
        }

        // =====================
        // Background Data Sync
        // =====================

        // Manual refresh from cloud (for when you want to pull latest data)
        async function manualRefresh() {
            const btn = document.querySelector('.refresh-btn');
            btn.classList.add('refreshing');
            
            try {
                if (CONFIG.USE_GOOGLE_SHEETS && CONFIG.SCRIPT_URL) {
                    const response = await fetch(`${CONFIG.SCRIPT_URL}?action=load`);
                    const result = await response.json();
                    
                    if (result.success && result.data) {
                        const oldTodayCount = state.today.dogs.length;
                        const oldTomorrowCount = state.tomorrow.dogs.length;
                        
                        state.today.dogs = result.data.today?.dogs || [];
                        state.today.staging = result.data.today?.staging || [];
                        state.today.vanTimes = result.data.today?.vanTimes || { BV: '07:30', DV: '08:00', SV: '08:30' };
                        state.tomorrow.dogs = result.data.tomorrow?.dogs || [];
                        state.tomorrow.staging = result.data.tomorrow?.staging || [];
                        state.tomorrow.vanTimes = result.data.tomorrow?.vanTimes || { BV: '07:30', DV: '08:00', SV: '08:30' };
                        
                        populateVanTimeDropdowns();
                        renderStaging('today');
                        renderStaging('tomorrow');
                        renderBoard('today');
                        renderBoard('tomorrow');
                        
                        const newTodayCount = state.today.dogs.length;
                        const newTomorrowCount = state.tomorrow.dogs.length;
                        
                        showToast(`â˜ï¸ Refreshed from cloud (Today: ${newTodayCount}, Tomorrow: ${newTomorrowCount})`, 'success');
                    } else {
                        showToast('âš ï¸ No data received from cloud', 'error');
                    }
                } else {
                    showToast('âš ï¸ Google Sheets not configured', 'error');
                }
            } catch (error) {
                console.error('Manual refresh failed:', error);
                showToast('âŒ Failed to refresh from cloud', 'error');
            } finally {
                btn.classList.remove('refreshing');
            }
        }

        async function loadBoardSilent() {
            // Load without showing toast (for background refresh)
            let data = null;
            
            // Try Google Sheets first
            if (CONFIG.USE_GOOGLE_SHEETS && CONFIG.SCRIPT_URL) {
                try {
                    const response = await fetch(`${CONFIG.SCRIPT_URL}?action=load`);
                    const result = await response.json();
                    
                    if (result.success && result.data) {
                        data = result.data;
                    }
                } catch (error) {
                    console.error('Failed to refresh from Google Sheets:', error);
                }
            }
            
            // Fall back to localStorage
            if (!data) {
                const saved = localStorage.getItem('fairyTailsStaffBoard');
                if (saved) {
                    try {
                        data = JSON.parse(saved);
                    } catch (e) {
                        console.error('Failed to parse localStorage:', e);
                        return;
                    }
                }
            }
            
            if (!data) return;
            
            // Check if data has changed
            const currentData = JSON.stringify({
                today: state.today,
                tomorrow: state.tomorrow
            });
            
            const newToday = {
                dogs: data.today?.dogs || [],
                staging: data.today?.staging || [],
                vanTimes: data.today?.vanTimes || { BV: '07:30', DV: '08:00', SV: '08:30' }
            };
            const newTomorrow = {
                dogs: data.tomorrow?.dogs || [],
                staging: data.tomorrow?.staging || [],
                vanTimes: data.tomorrow?.vanTimes || { BV: '07:30', DV: '08:00', SV: '08:30' }
            };
            
            const newData = JSON.stringify({
                today: newToday,
                tomorrow: newTomorrow
            });
            
            // Only re-render if data has changed
            if (currentData !== newData) {
                // Calculate what changed
                const oldTodayCount = state.today.dogs.length;
                const oldTomorrowCount = state.tomorrow.dogs.length;
                const newTodayCount = newToday.dogs.length;
                const newTomorrowCount = newTomorrow.dogs.length;
                
                state.today = newToday;
                state.tomorrow = newTomorrow;
                
                populateVanTimeDropdowns();
                renderStaging('today');
                renderStaging('tomorrow');
                renderBoard('today');
                renderBoard('tomorrow');
                
                console.log(`Data refreshed - Today: ${oldTodayCount}â†’${newTodayCount}, Tomorrow: ${oldTomorrowCount}â†’${newTomorrowCount}`);
            }
        }

        // =====================
        // Data Persistence (Google Sheets + localStorage fallback)
        // =====================
        
        async function saveBoard() {
            const dataToSave = {
                action: 'save',
                today: { 
                    dogs: state.today.dogs, 
                    staging: state.today.staging,
                    vanTimes: state.today.vanTimes
                },
                tomorrow: { 
                    dogs: state.tomorrow.dogs, 
                    staging: state.tomorrow.staging,
                    vanTimes: state.tomorrow.vanTimes
                }
            };
            
            // Always save to localStorage as backup
            localStorage.setItem('fairyTailsStaffBoard', JSON.stringify(dataToSave));
            
            // Save to Google Sheets if enabled
            if (CONFIG.USE_GOOGLE_SHEETS && CONFIG.SCRIPT_URL) {
                try {
                    const response = await fetch(CONFIG.SCRIPT_URL, {
                        method: 'POST',
                        mode: 'no-cors', // Google Apps Script requires this
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(dataToSave)
                    });
                    showToast('ðŸ’¾ Saved to cloud', 'success');
                } catch (error) {
                    console.error('Failed to save to Google Sheets:', error);
                    showToast('ðŸ’¾ Saved locally (cloud sync failed)', 'warning');
                }
            } else {
                showToast('ðŸ’¾ Board saved', 'success');
            }
        }

        async function loadBoard() {
            let loadedFromSheets = false;
            
            // Try to load from Google Sheets first (source of truth)
            if (CONFIG.USE_GOOGLE_SHEETS && CONFIG.SCRIPT_URL) {
                try {
                    const response = await fetch(`${CONFIG.SCRIPT_URL}?action=load`);
                    const result = await response.json();
                    
                    if (result.success && result.data) {
                        state.today.dogs = result.data.today?.dogs || [];
                        state.today.staging = result.data.today?.staging || [];
                        state.today.vanTimes = result.data.today?.vanTimes || { BV: '07:30', DV: '08:00', SV: '08:30' };
                        state.tomorrow.dogs = result.data.tomorrow?.dogs || [];
                        state.tomorrow.staging = result.data.tomorrow?.staging || [];
                        state.tomorrow.vanTimes = result.data.tomorrow?.vanTimes || { BV: '07:30', DV: '08:00', SV: '08:30' };
                        loadedFromSheets = true;
                        console.log('âœ… Loaded from Google Sheets:', {
                            today: state.today.dogs.length,
                            tomorrow: state.tomorrow.dogs.length
                        });
                    }
                } catch (error) {
                    console.error('âŒ Failed to load from Google Sheets:', error);
                }
            }
            
            // Fall back to localStorage ONLY if Google Sheets failed
            // But we need to be careful not to use stale localStorage data
            if (!loadedFromSheets) {
                console.warn('âš ï¸ Google Sheets unavailable - using localStorage (read-only mode until Sheets connects)');
                const saved = localStorage.getItem('fairyTailsStaffBoard');
                if (saved) {
                    try {
                        const data = JSON.parse(saved);
                        state.today.dogs = data.today?.dogs || [];
                        state.today.staging = data.today?.staging || [];
                        state.today.vanTimes = data.today?.vanTimes || { BV: '07:30', DV: '08:00', SV: '08:30' };
                        state.tomorrow.dogs = data.tomorrow?.dogs || [];
                        state.tomorrow.staging = data.tomorrow?.staging || [];
                        state.tomorrow.vanTimes = data.tomorrow?.vanTimes || { BV: '07:30', DV: '08:00', SV: '08:30' };
                        console.log('ðŸ“¦ Loaded from localStorage (temporary)');
                    } catch (e) {
                        console.error('Failed to load saved data:', e);
                    }
                }
                
                // Show warning that we're in offline mode
                showToast('âš ï¸ Could not connect to Google Sheets - changes may not save', 'error');
            }
            
            // Populate van time dropdowns
            populateVanTimeDropdowns();
            
            renderStaging('today');
            renderStaging('tomorrow');
            renderBoard('today');
            renderBoard('tomorrow');
            
            // CRITICAL: Only enable autoSave if we successfully loaded from Google Sheets
            // This prevents stale localStorage from overwriting fresh Sheet data
            if (loadedFromSheets) {
                state.initialLoadComplete = true;
                console.log('âœ… Initial load complete - autoSave now enabled');
            } else {
                state.initialLoadComplete = false;
                console.warn('âš ï¸ AutoSave DISABLED - waiting for Google Sheets connection');
                
                // Retry loading from Sheets every 10 seconds until successful
                setTimeout(retryLoadFromSheets, 10000);
            }
        }
        
        // Retry loading from Google Sheets if initial load failed
        async function retryLoadFromSheets() {
            if (state.initialLoadComplete) return; // Already loaded
            
            console.log('ðŸ”„ Retrying Google Sheets connection...');
            
            if (CONFIG.USE_GOOGLE_SHEETS && CONFIG.SCRIPT_URL) {
                try {
                    const response = await fetch(`${CONFIG.SCRIPT_URL}?action=load`);
                    const result = await response.json();
                    
                    if (result.success && result.data) {
                        // Check if remote has more data than local (prefer remote)
                        const remoteToday = result.data.today?.dogs?.length || 0;
                        const remoteTomorrow = result.data.tomorrow?.dogs?.length || 0;
                        const localToday = state.today.dogs.length;
                        const localTomorrow = state.tomorrow.dogs.length;
                        
                        // Use remote data if it has more dogs (more likely to be correct)
                        if (remoteToday >= localToday || remoteTomorrow >= localTomorrow) {
                            state.today.dogs = result.data.today?.dogs || [];
                            state.today.staging = result.data.today?.staging || [];
                            state.today.vanTimes = result.data.today?.vanTimes || state.today.vanTimes;
                            state.tomorrow.dogs = result.data.tomorrow?.dogs || [];
                            state.tomorrow.staging = result.data.tomorrow?.staging || [];
                            state.tomorrow.vanTimes = result.data.tomorrow?.vanTimes || state.tomorrow.vanTimes;
                            
                            populateVanTimeDropdowns();
                            renderStaging('today');
                            renderStaging('tomorrow');
                            renderBoard('today');
                            renderBoard('tomorrow');
                        }
                        
                        state.initialLoadComplete = true;
                        showToast('âœ… Connected to Google Sheets', 'success');
                        console.log('âœ… Reconnected to Google Sheets - autoSave now enabled');
                        return;
                    }
                } catch (error) {
                    console.error('Retry failed:', error);
                }
            }
            
            // Still not connected, retry again
            setTimeout(retryLoadFromSheets, 10000);
        }

        // Auto-save on changes (to both localStorage and Google Sheets)
        // SMART SAVE: Prevents overwriting remote data with empty local data
        async function autoSave(forceLocalOnly = false) {
            // CRITICAL: Never save until initial data load is complete
            // This prevents empty local state from overwriting remote data on page load
            if (!state.initialLoadComplete) {
                console.log('Initial load not complete - skipping save to prevent data loss');
                return;
            }
            
            const dataToSave = {
                action: 'save',
                today: { 
                    dogs: state.today.dogs, 
                    staging: state.today.staging,
                    vanTimes: state.today.vanTimes
                },
                tomorrow: { 
                    dogs: state.tomorrow.dogs, 
                    staging: state.tomorrow.staging,
                    vanTimes: state.tomorrow.vanTimes
                }
            };
            
            // Always save to localStorage
            localStorage.setItem('fairyTailsStaffBoard', JSON.stringify(dataToSave));
            
            // Skip Google Sheets save if forced local only
            if (forceLocalOnly) return;
            
            // Save to Google Sheets if enabled
            if (CONFIG.USE_GOOGLE_SHEETS && CONFIG.SCRIPT_URL) {
                try {
                    // SMART SAVE: Check if we're about to overwrite remote data with less data
                    const localTodayCount = state.today.dogs.length;
                    const localTomorrowCount = state.tomorrow.dogs.length;
                    const localTotal = localTodayCount + localTomorrowCount;
                    
                    // ALWAYS check remote first to prevent data loss
                    // This adds one extra request but prevents catastrophic data loss
                    console.log(`Checking remote before saving (local: Today=${localTodayCount}, Tomorrow=${localTomorrowCount})...`);
                    
                    try {
                        const response = await fetch(`${CONFIG.SCRIPT_URL}?action=load`);
                        const result = await response.json();
                        
                        if (result.success && result.data) {
                            const remoteTodayCount = result.data.today?.dogs?.length || 0;
                            const remoteTomorrowCount = result.data.tomorrow?.dogs?.length || 0;
                            const remoteTotal = remoteTodayCount + remoteTomorrowCount;
                            
                            // PROTECTION: If remote has MORE dogs than local, don't overwrite!
                            // This catches race conditions where remote was updated but local is stale
                            if (remoteTotal > localTotal) {
                                console.warn(`âš ï¸ BLOCKED SAVE: Remote has more data (${remoteTotal}) than local (${localTotal})`);
                                console.warn(`   Remote: Today=${remoteTodayCount}, Tomorrow=${remoteTomorrowCount}`);
                                console.warn(`   Local:  Today=${localTodayCount}, Tomorrow=${localTomorrowCount}`);
                                
                                // Reload remote data instead of saving
                                showToast('ðŸ”„ Syncing newer data from cloud...', 'info');
                                await loadBoardSilent();
                                return;
                            }
                            
                            // PROTECTION: If both are empty locally but remote has data, don't save
                            if (localTotal === 0 && remoteTotal > 0) {
                                console.warn(`âš ï¸ BLOCKED SAVE: Local is empty but remote has ${remoteTotal} dogs`);
                                await loadBoardSilent();
                                return;
                            }
                        }
                    } catch (checkError) {
                        console.error('Could not verify remote state - skipping save to be safe:', checkError);
                        return; // Don't save if we can't verify remote state
                    }
                    
                    // Safe to save - local has same or more data than remote
                    await fetch(CONFIG.SCRIPT_URL, {
                        method: 'POST',
                        mode: 'no-cors',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(dataToSave)
                    });
                    
                    console.log(`âœ… Saved to Google Sheets (Today: ${localTodayCount}, Tomorrow: ${localTomorrowCount})`);
                    
                } catch (error) {
                    console.error('Auto-save to Google Sheets failed:', error);
                }
            }
        }

        // Periodic outbound save (website â†’ Sheets) every 94 seconds
        setInterval(autoSave, 94000);

        // Periodic inbound refresh (Sheets â†’ website) every 93 seconds
        // Offset from outbound to minimise read/write clashes on Google Sheets
        setInterval(loadBoardSilent, 93000);

        // =====================
        // Initialization
        // =====================
        function init() {
            // Update clock
            updateTime();
            setInterval(updateTime, 1000);
            
            // Load saved data
            loadBoard();
        }

        // Start the app
        init();
    </script>
</body>
</html>
